\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile}{\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Components\textbackslash{}User\+Profile Class Reference}
\label{classDMA_1_1Friends_1_1Components_1_1UserProfile}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile}}
}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Components\textbackslash{}User\+Profile\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{de/dfc/classDMA_1_1Friends_1_1Components_1_1UserProfile}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a003e4e1407485743aaf55685f88787a4}{{\bfseries component\+Details} ()}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a003e4e1407485743aaf55685f88787a4}

\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_aecf1a686a45e5426a3c2f28a079e26ce}{{\bfseries define\+Properties} ()}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_aecf1a686a45e5426a3c2f28a079e26ce}

\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a32ac3402bed889d632b04caed5c38722}{{\bfseries on\+Run} ()}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a32ac3402bed889d632b04caed5c38722}

\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a8762bd608981dc640c3fb5d86090649e}{on\+Avatar} ()
\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a608fc1f7abe812d81cf14b8810d4e495}{{\bfseries on\+Avatar\+Save} ()}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a608fc1f7abe812d81cf14b8810d4e495}

\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_af07aef56eea64e63a102c3f4f5d4ee4e}{on\+Password} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_ad43136888e9abbd354167db885b1d0ee}{on\+Password\+Save} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_aeb1223b998f0e1e5eff79d84bda27011}{on\+Save} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a5ae2f68ad0cfa8793553ff64933a8f59}{get\+User} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1515663484c8d01a49e4d1824a6e7c1b}{add\+Assets} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a470d38c86107683dfa599a9140ae02a0}{make\+Partial} (\$partial, \$params=\mbox{[}$\,$\mbox{]}, \$throw\+Exception=true)
\end{DoxyCompactItemize}
\subsection*{Static Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1100f5a5b66bae37f71c2d4114c47f42}{get\+Theme\+Partials\+Dir} ()
\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1515663484c8d01a49e4d1824a6e7c1b}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!add\+Assets@{add\+Assets}}
\index{add\+Assets@{add\+Assets}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{add\+Assets}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::add\+Assets (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1515663484c8d01a49e4d1824a6e7c1b}
Add all css/js assets 
\begin{DoxyCode}
186     \{
187         $this->addJs(\textcolor{stringliteral}{'/modules/system/assets/vendor/bootstrap/js/modal.js'});
188         $this->addJs(\textcolor{stringliteral}{'/modules/backend/assets/js/october.popup.js'});
189     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1100f5a5b66bae37f71c2d4114c47f42}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!get\+Theme\+Partials\+Dir@{get\+Theme\+Partials\+Dir}}
\index{get\+Theme\+Partials\+Dir@{get\+Theme\+Partials\+Dir}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{get\+Theme\+Partials\+Dir}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::get\+Theme\+Partials\+Dir (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a1100f5a5b66bae37f71c2d4114c47f42}
Get the path to the theme's partials

\begin{DoxyReturn}{Returns}
string \$path 
\end{DoxyReturn}

\begin{DoxyCode}
235     \{
236         $theme = Theme::getActiveTheme();
237         \textcolor{keywordflow}{return} $theme->getPath() . \textcolor{stringliteral}{'/partials/'};
238     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a5ae2f68ad0cfa8793553ff64933a8f59}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!get\+User@{get\+User}}
\index{get\+User@{get\+User}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{get\+User}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::get\+User (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a5ae2f68ad0cfa8793553ff64933a8f59}
Get the authenticated user \begin{DoxyReturn}{Returns}
User \$user A user object 
\end{DoxyReturn}

\begin{DoxyCode}
174     \{
175         $user = Auth::getUser();
176 
177         \textcolor{keywordflow}{if} (!$user) \textcolor{keywordflow}{return} \textcolor{keyword}{false};
178 
179         \textcolor{keywordflow}{return} $user;
180     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a470d38c86107683dfa599a9140ae02a0}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!make\+Partial@{make\+Partial}}
\index{make\+Partial@{make\+Partial}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{make\+Partial}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::make\+Partial (
\begin{DoxyParamCaption}
\item[{}]{\$partial, }
\item[{}]{\$params = {\ttfamily \mbox{[}\mbox{]}}, }
\item[{}]{\$throw\+Exception = {\ttfamily true}}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a470d38c86107683dfa599a9140ae02a0}
Implementation of View\+Maker-\/$>$make\+Partial that renders a partial in a modal dialog and can accept a partial from the active theme


\begin{DoxyParams}[1]{Parameters}
string & {\em \$partial} & Name of the partial to be rendered. The partial must reside in the active theme's \char`\"{}partials\char`\"{} directory\\
\hline
array & {\em \$params} & An array of parameters to be passed to make\+Partial. See Backend for details\\
\hline
boolean & {\em \$throw\+Exception} & if true an exception will be thrown if the partial is not available\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
string \$content A rendered partial 
\end{DoxyReturn}

\begin{DoxyCode}
211     \{   
212         $partialsDir = self::getThemePartialsDir();
213         $partialPath = $partialsDir . $partial . \textcolor{stringliteral}{'.htm'};
214 
215         \textcolor{keywordflow}{if} (!File::isFile($partialPath)) \{
216             $partialPath = $this->getViewPath($partial) . \textcolor{stringliteral}{'.htm'};
217         \}
218 
219         \textcolor{keywordflow}{if} (!File::isFile($partialPath)) \{
220             \textcolor{keywordflow}{if} ($throwException)
221                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{namespaceSystemException}{SystemException}(Lang::get(\textcolor{stringliteral}{'backend::lang.partial.not\_found'}, [\textcolor{stringliteral}{'
      name'} => $partialPath]));
222             \textcolor{keywordflow}{else}
223                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
224         \}   
225 
226         \textcolor{keywordflow}{return} $this->makeFileContents($partialPath, $params);
227     \}   
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_a8762bd608981dc640c3fb5d86090649e}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!on\+Avatar@{on\+Avatar}}
\index{on\+Avatar@{on\+Avatar}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{on\+Avatar}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::on\+Avatar (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_a8762bd608981dc640c3fb5d86090649e}
render the change avatar popup 
\begin{DoxyCode}
47     \{
48 
49         $avatars = [];
50 
51         $themePath = \hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a2a61aaf01e9349803794f8fa7a743175}{UserLogin::getThemeDir}();
52         $avatarPath = $themePath . \textcolor{stringliteral}{'/assets/images/avatars/*.jpg'};
53 
54         \textcolor{comment}{// loop through all the files in the plugin's avatars directory and parse the file names}
55         \textcolor{keywordflow}{foreach} ( glob($avatarPath ) as $file ) \{ 
56             $path = str\_replace(base\_path(), \textcolor{stringliteral}{''}, $file);
57 
58             $avatars[] = [
59                 \textcolor{stringliteral}{'path'} => $path,
60                 \textcolor{stringliteral}{'basename'} => basename($path)
61             ];
62         \}
63 
64         $user = Auth::getUser();
65 
66         \textcolor{keywordflow}{return} $this->renderPartial(\textcolor{stringliteral}{'@modalDisplay'}, [
67             \textcolor{stringliteral}{'title'} => \textcolor{stringliteral}{'Select an avatar'},
68             \textcolor{stringliteral}{'content'} => $this->renderPartial(\textcolor{stringliteral}{'@avatars'}, [
69                 \textcolor{stringliteral}{'avatars'} => $avatars,
70                 \textcolor{stringliteral}{'userAvatar'} => $user->avatar->file\_name,
71             ]),
72         ]);
73 
74     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_af07aef56eea64e63a102c3f4f5d4ee4e}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!on\+Password@{on\+Password}}
\index{on\+Password@{on\+Password}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{on\+Password}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::on\+Password (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_af07aef56eea64e63a102c3f4f5d4ee4e}
Renders modal dialog with password change form 
\begin{DoxyCode}
96     \{
97         \textcolor{keywordflow}{return} $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a470d38c86107683dfa599a9140ae02a0}{makePartial}(\textcolor{stringliteral}{'changepassword'});
98     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_ad43136888e9abbd354167db885b1d0ee}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!on\+Password\+Save@{on\+Password\+Save}}
\index{on\+Password\+Save@{on\+Password\+Save}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{on\+Password\+Save}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::on\+Password\+Save (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_ad43136888e9abbd354167db885b1d0ee}
Verify that the user password is correct and save the new password 
\begin{DoxyCode}
104     \{
105         $data = post();
106         $user = $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a5ae2f68ad0cfa8793553ff64933a8f59}{getUser}();
107 
108         \textcolor{keywordflow}{if} (Hash::check($data[\textcolor{stringliteral}{'old\_password'}], $user->password)) \{
109             $user->password = $data[\textcolor{stringliteral}{'password'}];
110             $user->password\_confirmation = $data[\textcolor{stringliteral}{'password\_confirm'}];
111             
112             \textcolor{keywordflow}{if} ($user->save()) \{
113 
114                 \textcolor{comment}{// Re-authenticate the user}
115                 $user = Auth::authenticate([
116                     \textcolor{stringliteral}{'email'}     => $user->email,
117                     \textcolor{stringliteral}{'password'}  => $data[\textcolor{stringliteral}{'password'}],
118                 ], \textcolor{keyword}{true});
119 
120                 Flash::info(Lang::get(\textcolor{stringliteral}{'dma.friends::lang.user.passwordSave'}));
121             \} \textcolor{keywordflow}{else} \{
122                 Flash::error(Lang::get(\textcolor{stringliteral}{'dma.friends::lang.user.passwordFail'}));
123             \}
124         \} \textcolor{keywordflow}{else} \{
125             Flash::error(Lang::get(\textcolor{stringliteral}{'dma.friends::lang.user.passwordFail'}));
126         \}
127 
128         \textcolor{keywordflow}{return} [
129             \textcolor{stringliteral}{'#flashMessages'} => $this->renderPartial(\textcolor{stringliteral}{'@flashMessages'}),
130             \textcolor{stringliteral}{'.modal-body'}  => \textcolor{stringliteral}{"<script type='text/javascript'>$('button.close').click();</script>"},
131         ];
132 
133     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserProfile_aeb1223b998f0e1e5eff79d84bda27011}{\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}!on\+Save@{on\+Save}}
\index{on\+Save@{on\+Save}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Profile}}
\subsubsection[{on\+Save}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Profile\+::on\+Save (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Components_1_1UserProfile_aeb1223b998f0e1e5eff79d84bda27011}
Save the users profile 
\begin{DoxyCode}
139     \{
140         $user = $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserProfile_a5ae2f68ad0cfa8793553ff64933a8f59}{getUser}();
141 
142         $vars = post();
143         \textcolor{keywordflow}{foreach}($vars as $key => $val) \{
144             \textcolor{keywordflow}{if} ($key == \textcolor{stringliteral}{'metadata'}) \{
145                 $metadata = $user->metadata;
146                 \textcolor{keywordflow}{foreach}($val as $metakey => $metaval) \{
147                     $metadata->\{$metakey\} = $metaval;
148                 \}
149 
150                 $user->metadata()->save($metadata);
151 
152             \} \textcolor{keywordflow}{else} \{
153                 $user->\{$key\} = $val;
154             \}
155         \}
156 
157         \textcolor{keywordflow}{if} ($user->push()) \{
158             Flash::info(Lang::get(\textcolor{stringliteral}{'dma.friends::lang.user.save'}));
159         \} \textcolor{keywordflow}{else} \{
160             Flash::info(Lang::get(\textcolor{stringliteral}{'dma.friends::lang.user.saveFailed'}));
161         \}
162 
163         \textcolor{keywordflow}{return} [
164             \textcolor{stringliteral}{'#flashMessages'} => $this->renderPartial(\textcolor{stringliteral}{'@flashMessages'}),
165         ];
166     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
components/User\+Profile.\+php\end{DoxyCompactItemize}
