\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Components\textbackslash{}User\+Login Class Reference}
\label{classDMA_1_1Friends_1_1Components_1_1UserLogin}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login}}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Components\textbackslash{}User\+Login\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{df/d81/classDMA_1_1Friends_1_1Components_1_1UserLogin}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_acdfe6ac44ada2b3cfd131e0529e939bf}{}{\bfseries component\+Details} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_acdfe6ac44ada2b3cfd131e0529e939bf}

\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_aed0e2d9c2a568fa59e91b24d2c920639}{}{\bfseries define\+Properties} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_aed0e2d9c2a568fa59e91b24d2c920639}

\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_af4bf91673455e94e2af6807fcc7535cf}{}{\bfseries get\+Redirect\+Options} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_af4bf91673455e94e2af6807fcc7535cf}

\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a0820819b4447a5279432463d42d7a4e6}{}{\bfseries on\+Run} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a0820819b4447a5279432463d42d7a4e6}

\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_ae62d795e0eb073ab1e9b6e74425a04a7}{on\+Login} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a9f64120e2a98aca7bb6ad628d9a72844}{on\+User\+Login} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a232f43a38ed3fcdb7ebf6c774b031496}{on\+Forgot\+Password} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a61008348cecd24a9b01b20aeebc04b4b}{on\+Register} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a49b72261eed4c7750ca24e23ebecc945}{on\+Available\+User} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_adb35ec3a5460d1a197337104a54b55b1}{on\+Register\+Submit} ()
\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5390d4ee17957bf8df7209892cfdadb0}{}{\bfseries get\+Avatars} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5390d4ee17957bf8df7209892cfdadb0}

\item 
\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}{make\+Partial} (\$partial, \$params=\mbox{[}$\,$\mbox{]}, \$throw\+Exception=true)
\item 
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a58168b62fe7af6d5c5a70c3cd83c9707}{}{\bfseries load\+Assets} ()\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a58168b62fe7af6d5c5a70c3cd83c9707}

\end{DoxyCompactItemize}
\subsection*{Static Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a88372af498e2b89424acdab1537b0210}{get\+Theme\+Partials\+Dir} ()
\item 
static \hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a2a61aaf01e9349803794f8fa7a743175}{get\+Theme\+Dir} ()
\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a2a61aaf01e9349803794f8fa7a743175}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!get\+Theme\+Dir@{get\+Theme\+Dir}}
\index{get\+Theme\+Dir@{get\+Theme\+Dir}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{get\+Theme\+Dir}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::get\+Theme\+Dir (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a2a61aaf01e9349803794f8fa7a743175}
Get the path to the theme\textquotesingle{}s partials

\begin{DoxyReturn}{Returns}
string \$path 
\end{DoxyReturn}

\begin{DoxyCode}
352     \{
353         $theme = Theme::getActiveTheme();
354         \textcolor{keywordflow}{return} $theme->getPath();
355     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a88372af498e2b89424acdab1537b0210}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!get\+Theme\+Partials\+Dir@{get\+Theme\+Partials\+Dir}}
\index{get\+Theme\+Partials\+Dir@{get\+Theme\+Partials\+Dir}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{get\+Theme\+Partials\+Dir}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::get\+Theme\+Partials\+Dir (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a88372af498e2b89424acdab1537b0210}
Get the path to the theme\textquotesingle{}s partials

\begin{DoxyReturn}{Returns}
string \$path 
\end{DoxyReturn}

\begin{DoxyCode}
342     \{
343         \textcolor{keywordflow}{return} self::getThemeDir() . \textcolor{stringliteral}{'/partials/'};
344     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!make\+Partial@{make\+Partial}}
\index{make\+Partial@{make\+Partial}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{make\+Partial}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::make\+Partial (
\begin{DoxyParamCaption}
\item[{}]{\$partial, }
\item[{}]{\$params = {\ttfamily \mbox{[}\mbox{]}}, }
\item[{}]{\$throw\+Exception = {\ttfamily true}}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}
Implementation of View\+Maker-\/$>$make\+Partial that renders a partial in a modal dialog and can accept a partial from the active theme


\begin{DoxyParams}[1]{Parameters}
string & {\em \$partial} & Name of the partial to be rendered. The partial must reside in the active theme\textquotesingle{}s \char`\"{}partials\char`\"{} directory\\
\hline
array & {\em \$params} & An array of parameters to be passed to make\+Partial. See Backend for details\\
\hline
boolean & {\em \$throw\+Exception} & if true an exception will be thrown if the partial is not available\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
string \$content A rendered partial 
\end{DoxyReturn}

\begin{DoxyCode}
318     \{   
319         $partialsDir = self::getThemePartialsDir();
320         $partialPath = $partialsDir . $partial . \textcolor{stringliteral}{'.htm'};
321 
322         \textcolor{keywordflow}{if} (!File::isFile($partialPath)) \{
323             $partialPath = $this->getViewPath($partial) . \textcolor{stringliteral}{'.htm'};
324         \}
325 
326         \textcolor{keywordflow}{if} (!File::isFile($partialPath)) \{
327             \textcolor{keywordflow}{if} ($throwException)
328                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{namespaceSystemException}{SystemException}(Lang::get(\textcolor{stringliteral}{'backend::lang.partial.not\_found'}, [\textcolor{stringliteral}{'
      name'} => $partialPath]));
329             \textcolor{keywordflow}{else}
330                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
331         \}   
332 
333         \textcolor{keywordflow}{return} $this->makeFileContents($partialPath, $params);
334     \}   
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a49b72261eed4c7750ca24e23ebecc945}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+Available\+User@{on\+Available\+User}}
\index{on\+Available\+User@{on\+Available\+User}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+Available\+User}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+Available\+User (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a49b72261eed4c7750ca24e23ebecc945}
Verify if the given user mail is not already register 
\begin{DoxyCode}
180     \{
181         $email = post(\textcolor{stringliteral}{'email'});
182         $data = [\textcolor{stringliteral}{'available'} =>  \textcolor{keyword}{true}];
183         \textcolor{keywordflow}{if} ( User::where(\textcolor{stringliteral}{'email'}, $email)->count() > 0 ) \{
184             $data[\textcolor{stringliteral}{'available'}] = \textcolor{keyword}{false};
185         \}
186         \textcolor{keywordflow}{return} $data;
187     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a232f43a38ed3fcdb7ebf6c774b031496}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+Forgot\+Password@{on\+Forgot\+Password}}
\index{on\+Forgot\+Password@{on\+Forgot\+Password}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+Forgot\+Password}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+Forgot\+Password (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a232f43a38ed3fcdb7ebf6c774b031496}
Render the registration form. Override the partial \char`\"{}register-\/form\char`\"{} in the active theme to customize the registration form 
\begin{DoxyCode}
155     \{    
156         \textcolor{keywordflow}{return} $this->renderPartial(\textcolor{stringliteral}{'@modalDisplay'}, [
157             \textcolor{stringliteral}{'title'}     => Lang::get(\textcolor{stringliteral}{'dma.friends::lang.userLogin.forgotPasswordTitle'}),
158             \textcolor{stringliteral}{'content'}   => $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}{makePartial}(\textcolor{stringliteral}{'forgot-password'}),
159         ]);
160     \}    
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_ae62d795e0eb073ab1e9b6e74425a04a7}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+Login@{on\+Login}}
\index{on\+Login@{on\+Login}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+Login}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+Login (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_ae62d795e0eb073ab1e9b6e74425a04a7}
Render the login form. Override the partial \char`\"{}login-\/form\char`\"{} in the active theme to customize the login form 
\begin{DoxyCode}
61     \{        
62         \textcolor{keywordflow}{return} $this->renderPartial(\textcolor{stringliteral}{'@modalDisplay'}, [
63             \textcolor{stringliteral}{'title'}     => Lang::get(\textcolor{stringliteral}{'dma.friends::lang.userLogin.loginTitle'}),
64             \textcolor{stringliteral}{'content'}   => $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}{makePartial}(\textcolor{stringliteral}{'login-form'}),
65         ]);
66     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a61008348cecd24a9b01b20aeebc04b4b}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+Register@{on\+Register}}
\index{on\+Register@{on\+Register}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+Register}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+Register (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a61008348cecd24a9b01b20aeebc04b4b}
Render the registration form. Override the partial \char`\"{}register-\/form\char`\"{} in the active theme to customize the registration form 
\begin{DoxyCode}
167     \{
168         $options = \hyperlink{classDMA_1_1Friends_1_1Models_1_1Usermeta_a1acccb846d0ba68fcc9694cc0b1c4006}{Usermeta::getOptions}();
169 
170         \textcolor{keywordflow}{return} $this->renderPartial(\textcolor{stringliteral}{'@modalDisplay'}, [
171             \textcolor{stringliteral}{'title'}     => Lang::get(\textcolor{stringliteral}{'dma.friends::lang.userLogin.registerTitle'}),
172             \textcolor{stringliteral}{'content'}   => $this->\hyperlink{classDMA_1_1Friends_1_1Components_1_1UserLogin_a5845beab2a28f2a742da61b23a680eda}{makePartial}(\textcolor{stringliteral}{'register-form'}, [ \textcolor{stringliteral}{'options'} => $options ]),
173         ]);
174     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_adb35ec3a5460d1a197337104a54b55b1}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+Register\+Submit@{on\+Register\+Submit}}
\index{on\+Register\+Submit@{on\+Register\+Submit}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+Register\+Submit}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+Register\+Submit (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_adb35ec3a5460d1a197337104a54b55b1}
Submit handler for registration 
\begin{DoxyCode}
193     \{
194         $data = post();
195 
196         $rules = [
197             \textcolor{stringliteral}{'first\_name'}            => \textcolor{stringliteral}{'required|min:2'},
198             \textcolor{stringliteral}{'last\_name'}             => \textcolor{stringliteral}{'required|min:2'},
199             \textcolor{comment}{//'username'              => 'required|min:6',}
200             \textcolor{stringliteral}{'email'}                 => \textcolor{stringliteral}{'required|email|between:2,64'},
201             \textcolor{stringliteral}{'password'}              => \textcolor{stringliteral}{'required|min:6'},
202             \textcolor{stringliteral}{'password\_confirmation'} => \textcolor{stringliteral}{'required|min:6'},
203         ];
204 
205         $validation = Validator::make($data, $rules);
206         \textcolor{keywordflow}{if} ($validation->fails())
207             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ValidationException($validation);
208 
209         \textcolor{comment}{/*}
210 \textcolor{comment}{         * Register user}
211 \textcolor{comment}{         */}
212         $requireActivation = UserSettings::get(\textcolor{stringliteral}{'require\_activation'}, \textcolor{keyword}{true});
213         $automaticActivation = UserSettings::get(\textcolor{stringliteral}{'activate\_mode'}) == UserSettings::ACTIVATE\_AUTO;
214         $userActivation = UserSettings::get(\textcolor{stringliteral}{'activate\_mode'}) == UserSettings::ACTIVATE\_USER;
215 
216         \textcolor{comment}{// Split the data into whats required for the user and usermeta models}
217         $userData = [
218             \textcolor{stringliteral}{'name'}                  => $data[\textcolor{stringliteral}{'email'}],
219             \textcolor{stringliteral}{'password'}              => $data[\textcolor{stringliteral}{'password'}],
220             \textcolor{stringliteral}{'password\_confirmation'} => $data[\textcolor{stringliteral}{'password\_confirmation'}],
221             \textcolor{stringliteral}{'email'}                 => $data[\textcolor{stringliteral}{'email'}],
222             \textcolor{stringliteral}{'street\_addr'}           => $data[\textcolor{stringliteral}{'street\_addr'}],
223             \textcolor{stringliteral}{'city'}                  => $data[\textcolor{stringliteral}{'city'}],
224             \textcolor{stringliteral}{'state'}                 => $data[\textcolor{stringliteral}{'state'}],
225             \textcolor{stringliteral}{'zip'}                   => $data[\textcolor{stringliteral}{'zip'}],
226             \textcolor{stringliteral}{'phone'}                 => $data[\textcolor{stringliteral}{'phone'}],
227         ];
228 
229         $user = Auth::register($userData, $automaticActivation);
230 
231         $birth\_date = $data[\textcolor{stringliteral}{'birthday'}][\textcolor{stringliteral}{'year'}] 
232             . \textcolor{charliteral}{'-'} .  sprintf(\textcolor{stringliteral}{"%02s"}, $data[\textcolor{stringliteral}{'birthday'}][\textcolor{stringliteral}{'month'}]) 
233             . \textcolor{charliteral}{'-'} .  sprintf(\textcolor{stringliteral}{"%02s"}, $data[\textcolor{stringliteral}{'birthday'}][\textcolor{stringliteral}{'day'}])
234             . \textcolor{stringliteral}{' 00:00:00'};
235 
236         \textcolor{comment}{// Save user metadata}
237         $usermeta = \textcolor{keyword}{new} Usermeta;
238         $usermeta->first\_name       = $data[\textcolor{stringliteral}{'first\_name'}];
239         $usermeta->last\_name        = $data[\textcolor{stringliteral}{'last\_name'}];
240         $usermeta->gender           = $data[\textcolor{stringliteral}{'gender'}];
241         $usermeta->birth\_date       = $birth\_date;
242         $usermeta->race             = $data[\textcolor{stringliteral}{'race'}];
243         $usermeta->household\_income = $data[\textcolor{stringliteral}{'household\_income'}];
244         $usermeta->household\_size   = $data[\textcolor{stringliteral}{'household\_size'}];
245         $usermeta->education        = $data[\textcolor{stringliteral}{'education'}];
246         $usermeta->email\_optin      = isset($data[\textcolor{stringliteral}{'email\_optin'}]) ? $data[\textcolor{stringliteral}{'email\_optin'}] : \textcolor{keyword}{false};
247 
248         $user->metadata()->save($usermeta);
249 
250         UserExtend::uploadAvatar($user, $data[\textcolor{stringliteral}{'avatar'}]);
251 
252         \textcolor{comment}{/*}
253 \textcolor{comment}{         * Activation is by the user, send the email}
254 \textcolor{comment}{         */}
255         \textcolor{keywordflow}{if} ($userActivation) \{
256             $this->sendActivationEmail($user);
257         \}
258 
259         \textcolor{comment}{/*}
260 \textcolor{comment}{         * Automatically activated or not required, log the user in}
261 \textcolor{comment}{         */}
262         \textcolor{keywordflow}{if} ($automaticActivation || !$requireActivation) \{
263             Auth::login($user);
264         \}
265 
266         \textcolor{comment}{/*}
267 \textcolor{comment}{         * Fire event that user has registered}
268 \textcolor{comment}{         */}
269         Event::fire(\textcolor{stringliteral}{'auth.register'}, [$user]);
270 
271         \textcolor{comment}{/*}
272 \textcolor{comment}{         * Redirect to the intended page after successful sign in}
273 \textcolor{comment}{         */}
274         $redirectUrl = $this->pageUrl($this->property(\textcolor{stringliteral}{'redirect'}));
275 
276         \textcolor{keywordflow}{if} ($redirectUrl = post(\textcolor{stringliteral}{'redirect'}, $redirectUrl))
277             \textcolor{keywordflow}{return} Redirect::intended($redirectUrl);
278     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Components_1_1UserLogin_a9f64120e2a98aca7bb6ad628d9a72844}{}\index{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}!on\+User\+Login@{on\+User\+Login}}
\index{on\+User\+Login@{on\+User\+Login}!D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login@{D\+M\+A\+::\+Friends\+::\+Components\+::\+User\+Login}}
\subsubsection[{on\+User\+Login}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Components\textbackslash{}\+User\+Login\+::on\+User\+Login (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Components_1_1UserLogin_a9f64120e2a98aca7bb6ad628d9a72844}
Submit handler for the login form 
\begin{DoxyCode}
72     \{
73         \textcolor{keywordflow}{try}\{
74             
75             \textcolor{comment}{// Update wordpress passwords if necessary}
76             WordpressAuth::verifyFromEmail(post(\textcolor{stringliteral}{'email'}), post(\textcolor{stringliteral}{'password'}));
77       
78             \textcolor{comment}{/*  }
79 \textcolor{comment}{             * Validate input}
80 \textcolor{comment}{             */}
81             $data = post();
82             $rules = [ 
83                 \textcolor{stringliteral}{'password'} => \textcolor{stringliteral}{'required|min:2'}
84             ];  
85     
86             $loginAttribute = UserSettings::get(\textcolor{stringliteral}{'login\_attribute'}, UserSettings::LOGIN\_EMAIL);
87     
88             \textcolor{keywordflow}{if} ($loginAttribute == UserSettings::LOGIN\_USERNAME)
89                 $rules[\textcolor{stringliteral}{'login'}] = \textcolor{stringliteral}{'required|between:2,64'};
90             \textcolor{keywordflow}{else}
91                 $rules[\textcolor{stringliteral}{'login'}] = \textcolor{stringliteral}{'required|email|between:2,64'};
92     
93             \textcolor{keywordflow}{if} (!in\_array(\textcolor{stringliteral}{'login'}, $data))
94                 $data[\textcolor{stringliteral}{'login'}] = post(\textcolor{stringliteral}{'username'}, post(\textcolor{stringliteral}{'email'}));
95 
96             \textcolor{comment}{/*}
97 \textcolor{comment}{             * Validate user credentials}
98 \textcolor{comment}{             */}
99             $validation = Validator::make($data, $rules);
100             \textcolor{keywordflow}{if} ($validation->fails())
101                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ValidationException($validation);
102 
103         
104             \textcolor{comment}{/*  }
105 \textcolor{comment}{             * Authenticate user}
106 \textcolor{comment}{             */}
107             $user = Auth::authenticate([
108                 \textcolor{stringliteral}{'login'} => array\_get($data, \textcolor{stringliteral}{'login'}),
109                 \textcolor{stringliteral}{'password'} => array\_get($data, \textcolor{stringliteral}{'password'})
110             ], \textcolor{keyword}{true});
111     
112             \textcolor{comment}{/*}
113 \textcolor{comment}{             * Fire event that user has logged in}
114 \textcolor{comment}{             */}
115             Event::fire(\textcolor{stringliteral}{'auth.login'}, $user);
116     
117             \textcolor{comment}{/*  }
118 \textcolor{comment}{             * Redirect to the intended page after successful sign in}
119 \textcolor{comment}{             */}
120             $redirectUrl = $this->pageUrl($this->property(\textcolor{stringliteral}{'redirect'}));
121     
122             \textcolor{keywordflow}{if} ($redirectUrl = post(\textcolor{stringliteral}{'redirect'}, $redirectUrl))
123                 \textcolor{keywordflow}{return} Redirect::intended($redirectUrl);
124         
125         
126         \} \textcolor{keywordflow}{catch}(\(\backslash\)\hyperlink{namespaceException}{Exception} $e) \{
127             \textcolor{comment}{// Catch all exceptions producced by RainLab User or DMA authentication}
128             \textcolor{comment}{// and update error block message using OctoberCMS Ajax framework}
129             $message = Lang::get(\textcolor{stringliteral}{'dma.friends::lang.userLogin.failCredentials'});
130                        
131             \textcolor{comment}{// Bit doggy but if the exception message contains the login}
132             \textcolor{comment}{// is because the account is been suspend or banned by RainLab user plugin}
133             \textcolor{comment}{// This usually because the user has atent to loging multiple times with a }
134             \textcolor{comment}{// wrong password.}
135             \textcolor{keywordflow}{if}(preg\_match(\textcolor{stringliteral}{"/\(\backslash\)["} . $data[\textcolor{stringliteral}{'login'}] . \textcolor{stringliteral}{"\(\backslash\)]/"}, $e->getMessage()))\{ 
136                 $message = $message = Lang::get(\textcolor{stringliteral}{'dma.friends::lang.userLogin.throttleUser'}, $data);
137             \}
138             
139             \textcolor{comment}{// Send to log the authentication exception.}
140             \(\backslash\)Log::debug($e);
141             
142             \textcolor{keywordflow}{return} [
143                \textcolor{stringliteral}{'.modal-content #errorBlock'} => $message
144             ];
145       
146         \}
147         
148     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
components/User\+Login.\+php\end{DoxyCompactItemize}
