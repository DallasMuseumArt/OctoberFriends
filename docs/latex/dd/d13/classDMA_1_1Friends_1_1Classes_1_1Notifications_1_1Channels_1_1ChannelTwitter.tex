\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter}{\section{D\-M\-A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\-Twitter Class Reference}
\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter}\index{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter@{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter}}
}
Inheritance diagram for D\-M\-A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\-Twitter\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.546961cm]{dd/d13/classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a8fd04af027221ee77d05e70919c9bd11}{get\-Key} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a6e5f6e1abe8d6b7c9d0442c3f2560b44}{config\-Channel} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a51e362d79b1978fa683709e2794cb6d5}{setting\-Fields} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a14439c4b83e7d0e0dd0437f141a998e5}{send} (\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1NotificationMessage}{Notification\-Message} \$message)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a3b453a0cb63ace5be8f33763949af5b1}{read} ()
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel}{Channel} for sending Directed Messages notifications via Twitter. This channel is experimental. \begin{DoxyAuthor}{Author}
Carlos Arroyo 
\end{DoxyAuthor}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a6e5f6e1abe8d6b7c9d0442c3f2560b44}{\index{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}!config\-Channel@{config\-Channel}}
\index{config\-Channel@{config\-Channel}!DMA::Friends::Classes::Notifications::Channels::ChannelTwitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}}
\subsubsection[{config\-Channel}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter\-::config\-Channel (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a6e5f6e1abe8d6b7c9d0442c3f2560b44}
Load channel configurations. \begin{DoxySeeAlso}{See Also}
\-::config\-Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a63df08fbca39589ea32f729d9485cb37}{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel}.


\begin{DoxyCode}
31     \{
32         $this->settings = array(
33             \textcolor{stringliteral}{'oauth\_access\_token'}          => Settings::get(\textcolor{stringliteral}{'twitter\_access\_token'}),
34             \textcolor{stringliteral}{'oauth\_access\_token\_secret'}   => Settings::get(\textcolor{stringliteral}{'twitter\_access\_token\_secret'}),
35             \textcolor{stringliteral}{'consumer\_key'}                => Settings::get(\textcolor{stringliteral}{'twitter\_consumer\_key'}),
36             \textcolor{stringliteral}{'consumer\_secret'}             => Settings::get(\textcolor{stringliteral}{'twitter\_consumer\_key\_secret'}),
37         );
38 
39     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a8fd04af027221ee77d05e70919c9bd11}{\index{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}!get\-Key@{get\-Key}}
\index{get\-Key@{get\-Key}!DMA::Friends::Classes::Notifications::Channels::ChannelTwitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}}
\subsubsection[{get\-Key}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter\-::get\-Key (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a8fd04af027221ee77d05e70919c9bd11}
Used to identify view per channel.

\begin{DoxyReturn}{Returns}
string 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a2a1520c4a04a9533e0c755229376eb8a}{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel}.


\begin{DoxyCode}
22     \{
23         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'twitter'};
24     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a3b453a0cb63ace5be8f33763949af5b1}{\index{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}!read@{read}}
\index{read@{read}!DMA::Friends::Classes::Notifications::Channels::ChannelTwitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter\-::read (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a3b453a0cb63ace5be8f33763949af5b1}
Implemented specific logic for each channel for retriving incoming data through the channel.

\begin{DoxyReturn}{Returns}
array Array of \hyperlink{namespaceDMA}{D\-M\-A}
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See Also}
\-::read\-Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Listenable_aebc4dc5c57897e075a719e911a590d6e}{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Listenable}.


\begin{DoxyCode}
129     \{
130         \textcolor{comment}{//https://api.twitter.com/1.1/search/tweets.json}
131         $url = \textcolor{stringliteral}{'https://api.twitter.com/1.1/search/tweets.json'};
132         $requestMethod = \textcolor{stringliteral}{'GET'};
133 
134         $getfield = \textcolor{stringliteral}{'?q='} . Settings::get(\textcolor{stringliteral}{'twitter\_search\_hashtag'});
135         $maxId = Null;
136         If( $sinceId = Settings::set(\textcolor{stringliteral}{'twitter\_since\_id'}) &&
137             $maxId   = Settings::get(\textcolor{stringliteral}{'twitter\_max\_id'}) )\{
138             $getfield = $getfield . \textcolor{stringliteral}{'&since\_id='} . $sinceId;
139             $getfield = $getfield . \textcolor{stringliteral}{'&max\_id='} . $maxId;
140         \}
141 
142         $client = $this->getClient();
143         $response = $client->setGetfield($getfield)
144             ->buildOauth($url, $requestMethod)
145             ->performRequest();
146 
147         \textcolor{comment}{// Convert results to php objects}
148         $result = json\_decode($response);
149 
150 
151         \textcolor{comment}{// Convert tweets into messages}
152         $tweetIds = [];
153         $messages = [];
154         \textcolor{keywordflow}{foreach}($result->statuses as $tweet)\{
155 
156             $tweetId = $tweet->id;
157             \textcolor{comment}{// Because max\_id is also includes the tweet that we have already}
158             \textcolor{comment}{// processed if max\_id is present we remove this tweet from the messages.}
159             \textcolor{keywordflow}{if} ($tweetId != $maxId)\{
160                $tweetIds[] = $tweet->id;
161 
162                $msg = \textcolor{keyword}{new} IncomingMessage($this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a8fd04af027221ee77d05e70919c9bd11}{getKey}());
163                $msg->from($tweet->user->id, $tweet->user->name);
164                $msg->setContent($tweet->text);
165 
166                $messages[]=$msg;
167             \}
168 
169         \}
170 
171         \textcolor{comment}{// Get max\_id and since\_id}
172         \textcolor{comment}{// Further information on this Twitter parameters go to}
173         \textcolor{comment}{// https://dev.twitter.com/rest/public/timelines}
174         Settings::set(\textcolor{stringliteral}{'twitter\_max\_id'},   min($tweetIds));
175         Settings::set(\textcolor{stringliteral}{'twitter\_since\_id'}, max($tweetIds));
176 
177         \textcolor{keywordflow}{return} $messages;
178 
179     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a14439c4b83e7d0e0dd0437f141a998e5}{\index{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}!send@{send}}
\index{send@{send}!DMA::Friends::Classes::Notifications::Channels::ChannelTwitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}}
\subsubsection[{send}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter\-::send (
\begin{DoxyParamCaption}
\item[{{\bf Notification\-Message}}]{\$message}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a14439c4b83e7d0e0dd0437f141a998e5}
Use \hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1NotificationMessage}{Notification\-Message} set\-Data method to add user twitter\-Handle Send notifiation 
\begin{DoxyParams}{Parameters}
{\em D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Notification\-Message} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See Also}
\-::send() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a8138dfd93ce9617213637789e793f4c7}{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel}.


\begin{DoxyCode}
102     \{
103         \textcolor{comment}{// TODO : add validation to control the size of the message.}
104         $data          = $message->getData();
105         $txt           = $message->getContent();
106         $screen\_name   = $message->getTo();
107 
108         $url = \textcolor{stringliteral}{'https://api.twitter.com/1.1/direct\_messages/new.json'};
109         $postfields = [
110            \textcolor{stringliteral}{'screen\_name'} => $screen\_name,
111            \textcolor{stringliteral}{'text'} => $txt
112         ];
113         $requestMethod = \textcolor{stringliteral}{'POST'};
114 
115         $client = $this->getClient();
116         $response = $client->setPostfields($postfields)
117                             ->buildOauth($url, $requestMethod)
118                             ->performRequest();
119 
120 
121         echo($response);
122     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a51e362d79b1978fa683709e2794cb6d5}{\index{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}!setting\-Fields@{setting\-Fields}}
\index{setting\-Fields@{setting\-Fields}!DMA::Friends::Classes::Notifications::Channels::ChannelTwitter@{D\-M\-A\-::\-Friends\-::\-Classes\-::\-Notifications\-::\-Channels\-::\-Channel\-Twitter}}
\subsubsection[{setting\-Fields}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel\-Twitter\-::setting\-Fields (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelTwitter_a51e362d79b1978fa683709e2794cb6d5}
Return settings fields for this channel. For futher information go to \href{http://octobercms.com/docs/plugin/settings#database-settings}{\tt http\-://octobercms.\-com/docs/plugin/settings\#database-\/settings}

\begin{DoxyReturn}{Returns}
array
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See Also}
\-::setting\-Fields() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_aa473115fa58a6fa5f57a9069f23dd771}{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Classes\textbackslash{}\-Notifications\textbackslash{}\-Channels\textbackslash{}\-Channel}.


\begin{DoxyCode}
59     \{
60         \textcolor{keywordflow}{return} [
61             \textcolor{stringliteral}{'twitter\_access\_token'} => [
62                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Access token'},
63                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
64             ],
65             \textcolor{stringliteral}{'twitter\_access\_token\_secret'} => [
66                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Access token secret'},
67                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
68             ],
69             \textcolor{stringliteral}{'twitter\_consumer\_key'} => [
70                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Consumer key'},
71                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
72             ],
73             \textcolor{stringliteral}{'twitter\_consumer\_key\_secret'} => [
74                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Consumer key secret'},
75                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
76             ],
77             \textcolor{stringliteral}{'twitter\_search\_hashtag'} => [
78                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Search tweets with hashtag'},
79                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
80             ],
81             \textcolor{stringliteral}{'twitter\_since\_id'} => [
82                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Current Since ID'},
83                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'},
84                 \textcolor{stringliteral}{'description'} => \textcolor{stringliteral}{'This field is for tracking and debugin purposes'}
85             ],
86             \textcolor{stringliteral}{'twitter\_max\_id'} => [
87                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Current Max ID'},
88                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'},
89                 \textcolor{stringliteral}{'description'} => \textcolor{stringliteral}{'This field is for tracking and debugin purposes'}
90             ]
91 
92         ];
93 
94     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
classes/notifications/channels/Channel\-Twitter.\-php\end{DoxyCompactItemize}
