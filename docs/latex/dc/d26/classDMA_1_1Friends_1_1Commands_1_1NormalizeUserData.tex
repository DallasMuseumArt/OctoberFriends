\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Commands\textbackslash{}Normalize\+User\+Data Class Reference}
\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data}}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Commands\textbackslash{}Normalize\+User\+Data\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{dc/d26/classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}{fire} ()
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a1078b99623707b6392b0d791f8729cb8}{}{\bfseries normalize} (\$user)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a1078b99623707b6392b0d791f8729cb8}

\item 
\hyperlink{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}{normalize\+Phone} (\$user)
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a461a7984a9cd1ab0f7c5bc6be0edf90c}{}{\bfseries increase\+Counter} (\$name)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a461a7984a9cd1ab0f7c5bc6be0edf90c}

\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a4c66677355e7e5f797dd7bc296c46584}{}{\bfseries write\+Report} ()\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a4c66677355e7e5f797dd7bc296c46584}

\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a9c10e6d3ea1320d5aef15ddba36b325f}{}{\bfseries add\+To\+Report} (\$user, \$key, \$value)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a9c10e6d3ea1320d5aef15ddba36b325f}

\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_ad3564233e0bfca05feada7e6ff525aca}{}{\bfseries \$name} = \textquotesingle{}friends\+:normalize-\/users\textquotesingle{}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_ad3564233e0bfca05feada7e6ff525aca}

\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}{}\index{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}!fire@{fire}}
\index{fire@{fire}!D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}}
\subsubsection[{fire}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data\+::fire (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}
Read and process incomming data from listenable channels \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\begin{DoxyCode}
43     \{
44         
45         \textcolor{comment}{// Long run queries fill memory pretty quickly due to a default}
46         \textcolor{comment}{// behavior of Laravel where all queries are log in memory. Disabling}
47         \textcolor{comment}{// this log fix the issue. See http://laravel.com/docs/4.2/database#query-logging}
48         DB::connection()->disableQueryLog();
49         
50         
51         User::chunk(200, \textcolor{keyword}{function}($users)
52         \{
53 
54             \textcolor{keywordflow}{foreach} ($users as $user)
55             \{
56                 $this->increaseCounter(\textcolor{stringliteral}{'total\_users'});
57                 
58                 $data = $this->normalize($user);                
59 
60                 \textcolor{keywordflow}{foreach}($data as $attr => $value) \{
61                     $user->\{$attr\} = $value;
62                 \}
63                 
64                 $user->forceSave();
65                 
66             \}
67         \});
68         
69         
70         var\_dump($this->counters);
71         var\_dump($this->writeReport());
72 
73     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}{}\index{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}!normalize\+Phone@{normalize\+Phone}}
\index{normalize\+Phone@{normalize\+Phone}!D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}}
\subsubsection[{normalize\+Phone}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data\+::normalize\+Phone (
\begin{DoxyParamCaption}
\item[{}]{\$user}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}
Convert user phone field in to E.\+164 format 
\begin{DoxyParams}[1]{Parameters}
unknown & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Ambigous $<$N\+U\+L\+L, string, unknown, string$>$ 
\end{DoxyReturn}

\begin{DoxyCode}
91     \{
92         $cleanPhone = null;
93         $key = \textcolor{stringliteral}{'valid\_phone'};
94         
95         $phoneUtil = PhoneNumberUtil::getInstance();
96         \textcolor{keywordflow}{try} \{
97             \textcolor{comment}{// Get country code using configure timezone}
98             $tz = Carbon::now()->getTimezone();
99             $country\_code = array\_get($tz->getLocation(), \textcolor{stringliteral}{'country\_code'}, \textcolor{stringliteral}{'US'});
100             
101             \textcolor{comment}{// Parse phone number}
102             $numberProto = $phoneUtil->parse($user->phone, $country\_code);
103             
104             \textcolor{keywordflow}{if} ($phoneUtil->isValidNumber($numberProto))\{
105                 $cleanPhone = $phoneUtil->format($numberProto, PhoneNumberFormat::E164);
106                 
107             \}\textcolor{keywordflow}{else}\{
108                                
109                 \textcolor{comment}{// Emails that contain numbers can be mistaken as a vanity number ( 800 GODMA )}
110                 \textcolor{comment}{// so just for reporting purpose I check if the phone containts '@' is more likely it is an
       email }
111                 $isEmail = preg\_match(\textcolor{stringliteral}{'/@/'}, $user->phone);
112                 $key = ($isEmail) ? \textcolor{stringliteral}{'not\_a\_phone'} : \textcolor{stringliteral}{'invalid\_phone'}; 
113                 $this->addToReport($user, $key, $user->phone);
114                 
115             \}
116             
117         \} \textcolor{keywordflow}{catch} (\(\backslash\)libphonenumber\(\backslash\)NumberParseException $e) \{
118            
119             $key = \textcolor{stringliteral}{'phone\_empty'};
120             \textcolor{keywordflow}{if}(!empty($user->phone))\{
121                 $key = \textcolor{stringliteral}{'not\_a\_phone'};
122                 $this->addToReport($user, $key, $user->phone);
123             \}
124             
125         \}
126         
127         $this->increaseCounter($key);
128         
129         \textcolor{keywordflow}{return} $cleanPhone;
130     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
commands/Normalize\+User\+Data.\+php\end{DoxyCompactItemize}
