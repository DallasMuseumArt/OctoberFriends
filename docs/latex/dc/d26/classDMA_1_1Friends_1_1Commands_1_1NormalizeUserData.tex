\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Commands\textbackslash{}Normalize\+User\+Data Class Reference}
\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data}}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Commands\textbackslash{}Normalize\+User\+Data\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{dc/d26/classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}{fire} ()
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a1078b99623707b6392b0d791f8729cb8}{}{\bfseries normalize} (\$user)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a1078b99623707b6392b0d791f8729cb8}

\item 
\hyperlink{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}{normalize\+Phone} (\$user)
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a461a7984a9cd1ab0f7c5bc6be0edf90c}{}{\bfseries increase\+Counter} (\$name)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a461a7984a9cd1ab0f7c5bc6be0edf90c}

\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a4c66677355e7e5f797dd7bc296c46584}{}{\bfseries write\+Report} ()\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a4c66677355e7e5f797dd7bc296c46584}

\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a9c10e6d3ea1320d5aef15ddba36b325f}{}{\bfseries add\+To\+Report} (\$user, \$key, \$value)\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a9c10e6d3ea1320d5aef15ddba36b325f}

\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_ad3564233e0bfca05feada7e6ff525aca}{}{\bfseries \$name} = \textquotesingle{}friends\+:normalize-\/users\textquotesingle{}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_ad3564233e0bfca05feada7e6ff525aca}

\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}{}\index{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}!fire@{fire}}
\index{fire@{fire}!D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}}
\subsubsection[{fire}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data\+::fire (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_abb6a366bfe6d71d57c38eac99befc8f6}
Read and process incomming data from listenable channels \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\begin{DoxyCode}
41     \{
42         
43         \textcolor{comment}{// Long run queries fill memory pretty quickly due to a default}
44         \textcolor{comment}{// behavior of Laravel where all queries are log in memory. Disabling}
45         \textcolor{comment}{// this log fix the issue. See http://laravel.com/docs/4.2/database#query-logging}
46         DB::connection()->disableQueryLog();
47         
48         
49         User::chunk(200, \textcolor{keyword}{function}($users)
50         \{
51 
52             \textcolor{keywordflow}{foreach} ($users as $user)
53             \{
54                 $this->increaseCounter(\textcolor{stringliteral}{'total\_users'});
55                 
56                 $data = $this->normalize($user);                
57 
58                 \textcolor{keywordflow}{foreach}($data as $attr => $value) \{
59                     $user->\{$attr\} = $value;
60                 \}
61                 
62                 $user->forceSave();
63                 
64             \}
65         \});
66         
67         
68         var\_dump($this->counters);
69         var\_dump($this->writeReport());
70 
71     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}{}\index{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}!normalize\+Phone@{normalize\+Phone}}
\index{normalize\+Phone@{normalize\+Phone}!D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data@{D\+M\+A\+::\+Friends\+::\+Commands\+::\+Normalize\+User\+Data}}
\subsubsection[{normalize\+Phone}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Commands\textbackslash{}\+Normalize\+User\+Data\+::normalize\+Phone (
\begin{DoxyParamCaption}
\item[{}]{\$user}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}}\label{classDMA_1_1Friends_1_1Commands_1_1NormalizeUserData_a19288b02592b7e02e667651f3de20d2a}
Convert user phone field in to E.\+164 format 
\begin{DoxyParams}[1]{Parameters}
unknown & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Ambigous $<$N\+U\+L\+L, string, unknown, string$>$ 
\end{DoxyReturn}

\begin{DoxyCode}
89     \{
90         $cleanPhone = null;
91         $key = \textcolor{stringliteral}{'valid\_phone'};
92         
93         \textcolor{keywordflow}{try} \{
94 
95             \textcolor{keywordflow}{if} (!$cleanPhone = UserExtend::parsePhone($user->phone)) \{
96                          
97                 \textcolor{comment}{// Emails that contain numbers can be mistaken as a vanity number ( 800 GODMA )}
98                 \textcolor{comment}{// so just for reporting purpose I check if the phone containts '@' is more likely it is an
       email }
99                 $isEmail = preg\_match(\textcolor{stringliteral}{'/@/'}, $user->phone);
100                 $key = ($isEmail) ? \textcolor{stringliteral}{'not\_a\_phone'} : \textcolor{stringliteral}{'invalid\_phone'}; 
101                 $this->addToReport($user, $key, $user->phone);
102                 
103             \}
104             
105         \} \textcolor{keywordflow}{catch} (\(\backslash\)libphonenumber\(\backslash\)NumberParseException $e) \{
106            
107             $key = \textcolor{stringliteral}{'phone\_empty'};
108             \textcolor{keywordflow}{if}(!empty($user->phone))\{
109                 $key = \textcolor{stringliteral}{'not\_a\_phone'};
110                 $this->addToReport($user, $key, $user->phone);
111             \}
112             
113         \}
114         
115         $this->increaseCounter($key);
116         
117         \textcolor{keywordflow}{return} $cleanPhone;
118     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
commands/Normalize\+User\+Data.\+php\end{DoxyCompactItemize}
