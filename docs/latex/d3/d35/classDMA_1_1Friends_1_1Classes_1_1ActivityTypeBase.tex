\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase}{\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Activity\+Type\+Base Class Reference}
\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base}}
}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Activity\+Type\+Base\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.837838cm]{d3/d35/classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a6d83ca41e1c971c65cbc360e6097ad79}{details} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ac540cd6b45fa5f41575523bbb300d18c}{get\+Config} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ae46d0cc7e040eb4166e55a00d8d30dc8}{get\+Form\+Default\+Values} (\$model)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a69d28814a4cc0c3798d1ab7a95e14ef3}{save\+Data} (\$model, \$values)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a772667f95a25c6aa44e31ce9c6903384}{process} (User \$user, \$params)
\item 
static \hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_acc0d37915d9170364f381945fd01f7c2}{can\+Complete} (\hyperlink{classDMA_1_1Friends_1_1Models_1_1Activity}{Activity} \$activity, User \$user)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a6ead7996f0a00ff1109b45d6e6a7c10c}{{\bfseries \$field\+Config} = 'fields.\+yaml'}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a6ead7996f0a00ff1109b45d6e6a7c10c}

\end{DoxyCompactItemize}
\subsection*{Static Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_adb196a8d338da688f10f4a8da6480fd0}{convert\+Time} (\$time\+String)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a3542383d50c238777642e2ec09c61bfb}{{\bfseries \$dir\+Name}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a3542383d50c238777642e2ec09c61bfb}

\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_acc0d37915d9170364f381945fd01f7c2}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!can\+Complete@{can\+Complete}}
\index{can\+Complete@{can\+Complete}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{can\+Complete}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::can\+Complete (
\begin{DoxyParamCaption}
\item[{{\bf Activity}}]{\$activity, }
\item[{User}]{\$user}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_acc0d37915d9170364f381945fd01f7c2}
Determine if an activity is capable of being completed


\begin{DoxyParams}{Parameters}
{\em Activity} & An activity model\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean returns true if an activity can be completed by the user 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
158     \{   
159         \textcolor{keywordflow}{if} (!$activity->isActive()) \textcolor{keywordflow}{return} \textcolor{keyword}{false};
160 
161         \textcolor{comment}{// Check activity lockout}
162         \textcolor{keywordflow}{if} ($activity->activity\_lockout && $user->activities()->first()) \{
163             $time       = Carbon::now();
164             $lastTime   = $user->activities()->first()->pivot->created\_at;
165             $lastTime->addMinutes($activity->activity\_lockout);
166 
167             \textcolor{keywordflow}{if} ($time->diffInMinutes($lastTime) && $time->diffInMinutes($lastTime) < $activity->
      activity\_lockout) \{
168                 $x = $time->diffInMinutes($lastTime);
169                 Session::put(\textcolor{stringliteral}{'activityError'}, Lang::get(\textcolor{stringliteral}{'dma.friends::lang.activities.lockout'}, [\textcolor{charliteral}{'x'} => $x]
      ));
170                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
171             \}
172         \}
173 
174         \textcolor{comment}{//TODO: need a better way to return errors on why the activity couldnt complete}
175 
176         \textcolor{keywordflow}{switch} ($activity->time\_restriction) \{
177             \textcolor{keywordflow}{case} \hyperlink{classDMA_1_1Friends_1_1Models_1_1Activity_ab9dd8b18c4810beabdcf8e45039913c8}{Activity::TIME\_RESTRICT\_NONE}:
178                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};
179             \textcolor{keywordflow}{case} \hyperlink{classDMA_1_1Friends_1_1Models_1_1Activity_ac78040e8784e02c2d1bcce5221ac6cb8}{Activity::TIME\_RESTRICT\_HOURS}:
180                 \textcolor{keywordflow}{if} ($activity->time\_restriction\_data) \{
181 
182                     $now    = Carbon::now();
183                     $start  = self::convertTime($activity->time\_restriction\_data[\textcolor{stringliteral}{'start\_time'}]);
184                     $end    = self::convertTime($activity->time\_restriction\_data[\textcolor{stringliteral}{'end\_time'}]);
185 
186                     $start\_time = Carbon::now();
187                     $start\_time->setTime($start[\textcolor{stringliteral}{'hour'}], $start[\textcolor{stringliteral}{'minutes'}]);
188                     $end\_time   = Carbon::now();
189                     $end\_time->setTime($end[\textcolor{stringliteral}{'hour'}], $start[\textcolor{stringliteral}{'minutes'}]);
190                     $day        = date(\textcolor{charliteral}{'w'});
191 
192                     \textcolor{keywordflow}{if} ($activity->time\_restriction\_date[\textcolor{stringliteral}{'days'}][$day] !== \textcolor{keyword}{false}
193                         && $now->gte($start\_time) && $now->lte($end\_time)) \{
194 
195                         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
196                     \} \textcolor{keywordflow}{else} \{
197                         Session::put(\textcolor{stringliteral}{'activityError'}, Lang::get(\textcolor{stringliteral}{'dma.friends::lang.activities.notAvailable'}
      ));
198                     \}
199                 \}
200 
201                 \textcolor{keywordflow}{break};
202             \textcolor{keywordflow}{case} \hyperlink{classDMA_1_1Friends_1_1Models_1_1Activity_a71b85478f20cda144aeffe010364a0f7}{Activity::TIME\_RESTRICT\_DAYS}: 
203                 $now = \textcolor{keyword}{new} \hyperlink{namespaceDateTime}{DateTime}(\textcolor{stringliteral}{'now'});
204                 \textcolor{keywordflow}{if} ($now >= $activity->date\_begin 
205                     && $now <= $activity->date\_end) \{
206                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
207                 \} \textcolor{keywordflow}{else} \{
208                     Session::put(\textcolor{stringliteral}{'activityError'}, Lang::get(\textcolor{stringliteral}{'dma.friends::lang.activities.notAvailable'}));
209                 \}
210 
211                 \textcolor{keywordflow}{break};
212         \} 
213 
214         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
215     \} 
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_adb196a8d338da688f10f4a8da6480fd0}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!convert\+Time@{convert\+Time}}
\index{convert\+Time@{convert\+Time}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{convert\+Time}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::convert\+Time (
\begin{DoxyParamCaption}
\item[{}]{\$time\+String}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_adb196a8d338da688f10f4a8da6480fd0}
Convert a time string into an array


\begin{DoxyParams}[1]{Parameters}
string & {\em \$time\+String} & A time string ie (03\+:00pm)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array an array of the hour and minutes in military time 
\end{DoxyReturn}

\begin{DoxyCode}
227     \{
228         list($hour, $minutes) = explode(\textcolor{stringliteral}{":"}, $timeString);
229         $meridiem = substr($minutes, 2, 3);
230         $minutes = substr($minutes, 0, 1);
231 
232 
233         \textcolor{keywordflow}{if} (strtolower($meridiem) == \textcolor{stringliteral}{'pm'} || ($hour == \textcolor{stringliteral}{'12'} && strtolower($meridiem) == \textcolor{stringliteral}{'am'})) \{
234             $hour += 12;
235         \}
236 
237         \textcolor{keywordflow}{return} [
238             \textcolor{stringliteral}{'hour'}      => $hour,
239             \textcolor{stringliteral}{'minutes'}   => $minutes,
240         ];
241     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a6d83ca41e1c971c65cbc360e6097ad79}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!details@{details}}
\index{details@{details}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{details}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::details (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a6d83ca41e1c971c65cbc360e6097ad79}
Register details about your activity.

\begin{DoxyReturn}{Returns}
array An array of options
\begin{DoxyItemize}
\item name\+: The name of the activity type. This will be used in the form drop down when users configure an activity
\item description\+: (optional) An optional description of the activity type 
\end{DoxyItemize}
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
62 \{\}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ac540cd6b45fa5f41575523bbb300d18c}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!get\+Config@{get\+Config}}
\index{get\+Config@{get\+Config}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{get\+Config}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::get\+Config (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ac540cd6b45fa5f41575523bbb300d18c}
Return the path to the yaml configuration for additional form fields

\begin{DoxyReturn}{Returns}
string Y\+A\+M\+L config path 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
71     \{
72         \textcolor{keywordflow}{return} $this->dirName . \textcolor{charliteral}{'/'} . $this->fieldConfig;
73     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ae46d0cc7e040eb4166e55a00d8d30dc8}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!get\+Form\+Default\+Values@{get\+Form\+Default\+Values}}
\index{get\+Form\+Default\+Values@{get\+Form\+Default\+Values}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{get\+Form\+Default\+Values}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::get\+Form\+Default\+Values (
\begin{DoxyParamCaption}
\item[{}]{\$model}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_ae46d0cc7e040eb4166e55a00d8d30dc8}
If additional fields are configured then implement to tell the form how to get the default values


\begin{DoxyParams}[1]{Parameters}
object & {\em \$model} & The activity model\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array An array with matching key/value pairs for a set of custom fields 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
86 \{\}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a772667f95a25c6aa44e31ce9c6903384}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!process@{process}}
\index{process@{process}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{process}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::process (
\begin{DoxyParamCaption}
\item[{User}]{\$user, }
\item[{}]{\$params}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a772667f95a25c6aa44e31ce9c6903384}
Process and determine if an award can be issued based on a provided activity code


\begin{DoxyParams}[1]{Parameters}
object & {\em \$user} & A user model for which the activity should act upon\\
\hline
array & {\em \$params} & An array of parameters for validating activities\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean returns true if the process was successful 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
119     \{
120         $activity = $params[\textcolor{stringliteral}{'activity'}];
121 
122         \textcolor{keywordflow}{if} (self::canComplete($activity, $user)) \{
123             $userExtend = \textcolor{keyword}{new} UserExtend($user);
124             $userExtend->addPoints($activity->points);
125 
126             \textcolor{keywordflow}{if} ($user->activities()->save($activity)) \{
127 
128                 Event::fire(\textcolor{stringliteral}{'friends.activityCompleted'}, [ $user, $activity ]); 
129 
130                 \textcolor{comment}{// log an entry to the activity log}
131                 \hyperlink{classDMA_1_1Friends_1_1Classes_1_1FriendsLog_a0b90db29da51f53991f2dcc1a55f14c7}{FriendsLog::activity}([
132                     \textcolor{stringliteral}{'user'}          => $user,
133                     \textcolor{stringliteral}{'object'}        => $activity,
134                 ]); 
135 
136                 \textcolor{comment}{// Hand everything off to the badges}
137                 \hyperlink{classDMA_1_1Friends_1_1Classes_1_1BadgeManager_aecab9f0ae063c6bd484857abda4252bd}{BadgeManager::applyActivityToBadges}($user, $activity);
138 
139                 Session::put(\textcolor{stringliteral}{'activityMessage'}, Lang::get(\textcolor{stringliteral}{'dma.friends::lang.activities.codeSuccess'}, [\textcolor{stringliteral}{'
      title'} => $activity->title]));
140 
141                 \textcolor{keywordflow}{return} $activity;
142             \}
143         \}
144 
145         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
146     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a69d28814a4cc0c3798d1ab7a95e14ef3}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}!save\+Data@{save\+Data}}
\index{save\+Data@{save\+Data}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Activity\+Type\+Base}}
\subsubsection[{save\+Data}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+::save\+Data (
\begin{DoxyParamCaption}
\item[{}]{\$model, }
\item[{}]{\$values}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1ActivityTypeBase_a69d28814a4cc0c3798d1ab7a95e14ef3}
Save additional data for an activity type. By default attempt to save any additional field directly to model attributes


\begin{DoxyParams}[1]{Parameters}
object & {\em \$model} & An activity model\\
\hline
array & {\em \$values} & an array of values \\
\hline
\end{DoxyParams}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
99                                               \{
100         \textcolor{keywordflow}{foreach} ($values as $key => $val) \{
101             $model->\{$key\} = $val;
102         \}
103     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
classes/Activity\+Type\+Base.\+php\end{DoxyCompactItemize}
