\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup}{\section{D\-M\-A\textbackslash{}Friends\textbackslash{}Models\textbackslash{}User\-Group Class Reference}
\label{classDMA_1_1Friends_1_1Models_1_1UserGroup}\index{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group@{D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group}}
}
Inheritance diagram for D\-M\-A\textbackslash{}Friends\textbackslash{}Models\textbackslash{}User\-Group\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{d2/daf/classDMA_1_1Friends_1_1Models_1_1UserGroup}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7f998f837a0bd734e0f1496f6902793f}{get\-Users} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a13eaffc2b414fe5dfd42aa6ac5fe75ca}{add\-User} (\&\$user)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac08ee6038b5f0314c341123025484b91}{remove\-User} (\$user)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{in\-Group} (\$user, \$include\-All=false)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac55e9a0b178ed308374720c3dd9d7f90}{accept\-Membership} (\&\$user)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a09e0cf14a97b5618bd5db36dc320bf7e}{reject\-Membership} (\&\$user)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a0e21f8d83c3a53b9119fff9395da55a4}{cancel\-Membership} (\&\$user)
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac81ce5f041517ca368383038a9443034}{send\-Notification} (\&\$user, \$notification\-Name)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a556c5f9443e270feb7824c30de13b85f}{boot} ()
\item 
static \hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a869b9c67b74345d970d62c9fba9f9d2d}{mark\-Inactive\-Groups} (\$datetime=null)
\item 
static \hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a98977f281ed3d9dc85220af0207c764d}{has\-Active\-Memberships} (\$user)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
{\bfseries \$rules}
\item 
{\bfseries \$belongs\-To\-Many}
\item 
{\bfseries \$belongs\-To}
\item 
{\bfseries \$morph\-Many}
\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7c8222c3e74df7e5f392db954bc6e70b}{const {\bfseries M\-E\-M\-B\-E\-R\-S\-H\-I\-P\-\_\-\-P\-E\-N\-D\-I\-N\-G} = 'P\-E\-N\-D\-I\-N\-G'}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7c8222c3e74df7e5f392db954bc6e70b}

\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7c23f715047baa55b359250eb7ec3936}{const {\bfseries M\-E\-M\-B\-E\-R\-S\-H\-I\-P\-\_\-\-A\-C\-C\-E\-P\-T\-E\-D} = 'A\-C\-C\-E\-P\-T\-E\-D'}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7c23f715047baa55b359250eb7ec3936}

\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a4d38303c9b869050114862be4674191f}{const {\bfseries M\-E\-M\-B\-E\-R\-S\-H\-I\-P\-\_\-\-R\-E\-J\-E\-C\-T\-E\-D} = 'R\-E\-J\-E\-C\-T\-E\-D'}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a4d38303c9b869050114862be4674191f}

\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a40fdb6407bcd12e19a13706ced558e40}{const {\bfseries M\-E\-M\-B\-E\-R\-S\-H\-I\-P\-\_\-\-C\-A\-N\-C\-E\-L\-L\-E\-D} = 'C\-A\-N\-C\-E\-L\-L\-E\-D'}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a40fdb6407bcd12e19a13706ced558e40}

\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}{fire\-Group\-Event} (\$event, \$params=\mbox{[}$\,$\mbox{]})
\item 
\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{set\-Membership\-Status} (\&\$user, \$status, \$test\-User\-In\-Group=true)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_aee86ae41de6359cbf5f2f6bfd786f3b3}{{\bfseries \$table} = 'dma\-\_\-friends\-\_\-user\-\_\-groups'}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_aee86ae41de6359cbf5f2f6bfd786f3b3}

\item 
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a648519751985d808d8c65bcd3bc07eb0}{{\bfseries \$group\-Users}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a648519751985d808d8c65bcd3bc07eb0}

\end{DoxyCompactItemize}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac55e9a0b178ed308374720c3dd9d7f90}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!accept\-Membership@{accept\-Membership}}
\index{accept\-Membership@{accept\-Membership}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{accept\-Membership}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::accept\-Membership (
\begin{DoxyParamCaption}
\item[{\&}]{\$user}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac55e9a0b178ed308374720c3dd9d7f90}
User accept invite 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
230     \{
231         \textcolor{comment}{// Test this users is not part of an active group}
232         \textcolor{keywordflow}{if}(self::hasActiveMemberships($user))
233             \textcolor{keywordflow}{return} \textcolor{keyword}{false};        
234         $status = $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{setMembershipStatus}($user, self::MEMBERSHIP\_ACCEPTED);
235         \textcolor{keywordflow}{return} $status == self::MEMBERSHIP\_ACCEPTED;
236     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a13eaffc2b414fe5dfd42aa6ac5fe75ca}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!add\-User@{add\-User}}
\index{add\-User@{add\-User}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{add\-User}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::add\-User (
\begin{DoxyParamCaption}
\item[{\&}]{\$user}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a13eaffc2b414fe5dfd42aa6ac5fe75ca}
Adds the user to the group. 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
143     \{
144 
145         \textcolor{keywordflow}{if} (count($this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7f998f837a0bd734e0f1496f6902793f}{getUsers}()) < Settings::get(\textcolor{stringliteral}{'maximum\_users\_group'})
146             && $this->is\_active )\{
147             \textcolor{keywordflow}{if} (!$this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{inGroup}($user)) \{
148                 
149                 \textcolor{comment}{// Test this users is not part of an active group}
150                 \textcolor{keywordflow}{if}(self::hasActiveMemberships($user))
151                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
152                 
153                 \textcolor{keywordflow}{try}\{
154                     $this->users()->attach($user);
155                     $this->groupUsers = null;
156                     
157                 \}\textcolor{keywordflow}{catch}(QueryException $e)\{
158                     \textcolor{comment}{// SQL integrity user and group relation already exists.}
159                     \textcolor{keywordflow}{if} ($e->getCode() == 23000)\{
160                         \textcolor{comment}{// User was part of the group but rejected or cancel}
161                         \textcolor{comment}{// the membership. As the user is not part of other group}
162                         \textcolor{comment}{// yet, the creator is able to re-invite user to join the group}
163                         $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{setMembershipStatus}($user, self::MEMBERSHIP\_PENDING, 
      $testUserInGroup=\textcolor{keyword}{false});
164                     \}
165                 \}
166                 
167                 $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac81ce5f041517ca368383038a9443034}{sendNotification}($user, \textcolor{stringliteral}{'invite'});
168                 
169                 \textcolor{comment}{// Fire event }
170                 $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}{fireGroupEvent}(\textcolor{stringliteral}{'user.added'}, array($this, $user));
171                 
172                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};
173             \}
174         \}\textcolor{keywordflow}{else}\{
175             \textcolor{comment}{// TODO : Raise exceptions or fire events }
176         \}
177 
178         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
179     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a556c5f9443e270feb7824c30de13b85f}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!boot@{boot}}
\index{boot@{boot}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{boot}]{\setlength{\rightskip}{0pt plus 5cm}static D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::boot (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a556c5f9443e270feb7824c30de13b85f}
\begin{DoxySeeAlso}{See Also}
\-::boot() 
\end{DoxySeeAlso}

\begin{DoxyCode}
71     \{
72         parent::boot();
73     
74         \textcolor{comment}{// Setup event bindings...}
75         \textcolor{comment}{//UserGroup::observe(new UserGroupObserver);}
76     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a0e21f8d83c3a53b9119fff9395da55a4}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!cancel\-Membership@{cancel\-Membership}}
\index{cancel\-Membership@{cancel\-Membership}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{cancel\-Membership}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::cancel\-Membership (
\begin{DoxyParamCaption}
\item[{\&}]{\$user}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a0e21f8d83c3a53b9119fff9395da55a4}
User accept invite 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
255     \{            
256         $status = $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{setMembershipStatus}($user, self::MEMBERSHIP\_CANCELLED);
257         \textcolor{keywordflow}{return} $status == self::MEMBERSHIP\_CANCELLED;        
258     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!fire\-Group\-Event@{fire\-Group\-Event}}
\index{fire\-Group\-Event@{fire\-Group\-Event}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{fire\-Group\-Event}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::fire\-Group\-Event (
\begin{DoxyParamCaption}
\item[{}]{\$event, }
\item[{}]{\$params = {\ttfamily \mbox{[}\mbox{]}}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}
\begin{DoxySeeAlso}{See Also}
\-::save() Fire an event and call the listeners. 
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
string & {\em \$event} & Event name \\
\hline
array & {\em \$params} & Event parameters \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
98     \{
99         \textcolor{comment}{// TODO : This method could be converted in a Trait }
100         
101         \textcolor{comment}{// Add event namespace}
102         $event = \textcolor{stringliteral}{"dma.friends.group.$event"};
103         \textcolor{comment}{// Fire local event calling October Trait fireEvent}
104         \textcolor{comment}{//return $this->fireEvent($event, $params, $halt);}
105         \textcolor{comment}{// Fire Global event }
106         Event::fire($event, $params);
107     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7f998f837a0bd734e0f1496f6902793f}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!get\-Users@{get\-Users}}
\index{get\-Users@{get\-Users}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{get\-Users}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::get\-Users (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7f998f837a0bd734e0f1496f6902793f}
Returns an array of users which the given group belongs to. Only returns Pending and Active users \begin{DoxyReturn}{Returns}
array 
\end{DoxyReturn}

\begin{DoxyCode}
124     \{
125         \textcolor{keywordflow}{if} (!$this->groupUsers)\{
126             $this->groupUsers = $this->users()->where(\textcolor{keyword}{function}($query)\{
127                    $status = [ UserGroup::MEMBERSHIP\_PENDING,
128                                UserGroup::MEMBERSHIP\_ACCEPTED
129                             ];
130                     $query->whereIn(\textcolor{stringliteral}{'membership\_status'}, $status);
131             \})->\textcolor{keyword}{get}();  
132         \}          
133             
134         \textcolor{keywordflow}{return} $this->groupUsers;
135     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a98977f281ed3d9dc85220af0207c764d}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!has\-Active\-Memberships@{has\-Active\-Memberships}}
\index{has\-Active\-Memberships@{has\-Active\-Memberships}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{has\-Active\-Memberships}]{\setlength{\rightskip}{0pt plus 5cm}static D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::has\-Active\-Memberships (
\begin{DoxyParamCaption}
\item[{}]{\$user}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a98977f281ed3d9dc85220af0207c764d}
Test if user has active memberships


\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean 
\end{DoxyReturn}

\begin{DoxyCode}
306                                                       \{
307         $status = self::MEMBERSHIP\_ACCEPTED;
308         $groups = self::where(\textcolor{stringliteral}{'is\_active'}, \textcolor{keyword}{true})
309                     ->with(\textcolor{stringliteral}{'users'})
310                     ->whereHas(\textcolor{stringliteral}{'users'}, \textcolor{keyword}{function}($query) use ($user, $status)\{
311                         $query->where(\textcolor{stringliteral}{'membership\_status'}, $status)
312                               ->where(\textcolor{stringliteral}{'user\_id'}, $user->getKey());
313                     \}
314         )->\textcolor{keyword}{get}();
315         
316         \textcolor{keywordflow}{return} count($groups) > 0;
317     \}  
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!in\-Group@{in\-Group}}
\index{in\-Group@{in\-Group}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{in\-Group}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::in\-Group (
\begin{DoxyParamCaption}
\item[{}]{\$user, }
\item[{}]{\$include\-All = {\ttfamily false}}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}
See if the user is in the group. 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & boolean if True check all users attach to the group regarless of the status. if True check only filtered users returned by get\-Users method. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
209     \{
210         $users = $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7f998f837a0bd734e0f1496f6902793f}{getUsers}();
211         \textcolor{keywordflow}{if} ($includeAll) $users = $this->users()->get();
212         
213         \textcolor{keywordflow}{foreach} ($users as $u) \{
214             \textcolor{keywordflow}{if} ($u->getKey() == $user->getKey())
215                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};
216         \}
217     
218         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
219     \}    
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a869b9c67b74345d970d62c9fba9f9d2d}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!mark\-Inactive\-Groups@{mark\-Inactive\-Groups}}
\index{mark\-Inactive\-Groups@{mark\-Inactive\-Groups}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{mark\-Inactive\-Groups}]{\setlength{\rightskip}{0pt plus 5cm}static D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::mark\-Inactive\-Groups (
\begin{DoxyParamCaption}
\item[{}]{\$datetime = {\ttfamily null}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a869b9c67b74345d970d62c9fba9f9d2d}
Mark inactive all open groups 
\begin{DoxyParams}[1]{Parameters}
unknown & {\em \$datetime} & \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
113                                                              \{
114         \textcolor{keywordflow}{return} self::where(\textcolor{stringliteral}{'is\_active'}, \textcolor{charliteral}{'='}, \textcolor{keyword}{true})
115         ->update(array(\textcolor{stringliteral}{'is\_active'} => \textcolor{keyword}{false}));
116     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a09e0cf14a97b5618bd5db36dc320bf7e}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!reject\-Membership@{reject\-Membership}}
\index{reject\-Membership@{reject\-Membership}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{reject\-Membership}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::reject\-Membership (
\begin{DoxyParamCaption}
\item[{\&}]{\$user}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a09e0cf14a97b5618bd5db36dc320bf7e}
User accept invite 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
244     \{
245         $status = $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{setMembershipStatus}($user, self::MEMBERSHIP\_REJECTED);
246         \textcolor{keywordflow}{return} $status == self::MEMBERSHIP\_REJECTED;
247     \}    
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac08ee6038b5f0314c341123025484b91}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!remove\-User@{remove\-User}}
\index{remove\-User@{remove\-User}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{remove\-User}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::remove\-User (
\begin{DoxyParamCaption}
\item[{}]{\$user}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac08ee6038b5f0314c341123025484b91}
Removes the user from the group. 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool 
\end{DoxyReturn}

\begin{DoxyCode}
187     \{
188         \textcolor{keywordflow}{if} ($this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{inGroup}($user, $includeAll=\textcolor{keyword}{true})) \{
189             $this->users()->detach($user);
190             $this->groupUsers = null;
191             
192             \textcolor{comment}{// Fire event}
193             $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}{fireGroupEvent}(\textcolor{stringliteral}{'user.removed'}, array($this, $user));
194             
195             \textcolor{keywordflow}{return} \textcolor{keyword}{true};
196         \}
197     
198         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
199     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac81ce5f041517ca368383038a9443034}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!send\-Notification@{send\-Notification}}
\index{send\-Notification@{send\-Notification}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{send\-Notification}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::send\-Notification (
\begin{DoxyParamCaption}
\item[{\&}]{\$user, }
\item[{}]{\$notification\-Name}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac81ce5f041517ca368383038a9443034}

\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \$user \\
\hline
string & {\em \$notification\-Name} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean$\vert$\-Ambigous $<$boolean, void$>$ 
\end{DoxyReturn}

\begin{DoxyCode}
327     \{
328         \textcolor{comment}{// Check if the user is part of the group or the owner.}
329         \textcolor{keywordflow}{if} (!$this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{inGroup}($user)) 
330             \textcolor{keywordflow}{if}($this->owner->getKey() != $user->getKey()) 
331                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};
332             
333         $group      = $this;
334         $fromUser   = $this->owner;
335         \(\backslash\)Postman::send(\textcolor{stringliteral}{'group-request'}, \textcolor{keyword}{function}($notification) use ($user, $fromUser, $group)\{
336             $notification->to($user, $user->name);
337             $notification->from($fromUser);
338             $notification->subject(\textcolor{stringliteral}{'Group request'});
339             $notification->attachObject($group);
340         \});
341         
342         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
343     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!set\-Membership\-Status@{set\-Membership\-Status}}
\index{set\-Membership\-Status@{set\-Membership\-Status}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{set\-Membership\-Status}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::set\-Membership\-Status (
\begin{DoxyParamCaption}
\item[{\&}]{\$user, }
\item[{}]{\$status, }
\item[{}]{\$test\-User\-In\-Group = {\ttfamily true}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a7a52268ecbdd67ab80d28d65a8149a5a}
Change membership status, send notification. 
\begin{DoxyParams}[1]{Parameters}
Rain\-Lab\textbackslash{}\-User\textbackslash{}\-Models\textbackslash{}\-User & {\em \$user} & \\
\hline
string & {\em \$status} & P\-E\-N\-D\-I\-N\-G, A\-C\-C\-E\-P\-T\-E\-D, R\-E\-J\-E\-C\-T\-E\-D, C\-A\-N\-C\-E\-L\-L\-E\-D \\
\hline
boolean & {\em \$test\-User\-In\-Group} & If true only allow to change status to active or pending users. If false ignore this restriction. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
string 
\end{DoxyReturn}

\begin{DoxyCode}
269     \{
270         \textcolor{keywordflow}{if} ($this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_aab0755a408dcbff4a64277cd9032b9bf}{inGroup}($user, $includeAll=!$testUserInGroup))\{
271             
272             \textcolor{comment}{// FIXME : See comments in loadPivot method}
273             $this->loadPivot($user);
274             
275             \textcolor{keywordflow}{if} ($user->pivot->membership\_status != $status)\{
276                 $user->pivot->membership\_status = $status;
277                 $user->pivot->save();
278                 
279                 \textcolor{comment}{// Clean cache of groups}
280                 $this->groupUsers = null;
281                 
282                 \textcolor{comment}{// Send notification to group owners if the status}
283                 \textcolor{comment}{// is different to PENDING. That notification is send by addUser.}
284                 \textcolor{keywordflow}{if} ($status != self::MEMBERSHIP\_PENDING)\{
285                     $notificationName = strtolower($status);
286                     $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_ac81ce5f041517ca368383038a9443034}{sendNotification}($this->owner, $notificationName);
287                     
288                     \textcolor{comment}{// Fire event}
289                     $event = strtolower($status);
290                     $this->\hyperlink{classDMA_1_1Friends_1_1Models_1_1UserGroup_a1d29514398539f2e5579d0cc4c6a26fa}{fireGroupEvent}(\textcolor{stringliteral}{"invite.$event"}, array($this, $user));
291                 \}
292             \}\textcolor{keywordflow}{else}\{
293                 \textcolor{comment}{// Return current user status}
294                 \textcolor{keywordflow}{return} $user->pivot->membership\_status; 
295             \}
296             \textcolor{keywordflow}{return} $status;
297         \}
298     \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a941362fd666e66db70f4b5951cba0154}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!\$belongs\-To@{\$belongs\-To}}
\index{\$belongs\-To@{\$belongs\-To}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{\$belongs\-To}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::\$belongs\-To}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a941362fd666e66db70f4b5951cba0154}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= [
        \textcolor{stringliteral}{'owner'} => [\textcolor{stringliteral}{'Rainlab\(\backslash\)User\(\backslash\)Models\(\backslash\)User'}, \textcolor{stringliteral}{'foreignKey'} => \textcolor{stringliteral}{'owner\_id'}]    
    ]
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_a09a5f57f3092a3bf0aa240cf8ca949a8}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!\$belongs\-To\-Many@{\$belongs\-To\-Many}}
\index{\$belongs\-To\-Many@{\$belongs\-To\-Many}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{\$belongs\-To\-Many}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::\$belongs\-To\-Many}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_a09a5f57f3092a3bf0aa240cf8ca949a8}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= [
        \textcolor{stringliteral}{'users'} => [\textcolor{stringliteral}{'Rainlab\(\backslash\)User\(\backslash\)Models\(\backslash\)User'}, 
        \textcolor{stringliteral}{'table'} => \textcolor{stringliteral}{'dma\_friends\_users\_groups'}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_ad71c8521c1767d621fe10ea3ce822c3c}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!\$morph\-Many@{\$morph\-Many}}
\index{\$morph\-Many@{\$morph\-Many}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{\$morph\-Many}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::\$morph\-Many}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_ad71c8521c1767d621fe10ea3ce822c3c}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= [
        \textcolor{stringliteral}{'notifications'}  => [\textcolor{stringliteral}{'DMA\(\backslash\)Notification\(\backslash\)Models\(\backslash\)Notification'}, \textcolor{stringliteral}{'name'} => \textcolor{stringliteral}{'object'}],
    ]
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Models_1_1UserGroup_afe3638379efd008d908f38c86b434c76}{\index{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}!\$rules@{\$rules}}
\index{\$rules@{\$rules}!DMA::Friends::Models::UserGroup@{D\-M\-A\-::\-Friends\-::\-Models\-::\-User\-Group}}
\subsubsection[{\$rules}]{\setlength{\rightskip}{0pt plus 5cm}D\-M\-A\textbackslash{}\-Friends\textbackslash{}\-Models\textbackslash{}\-User\-Group\-::\$rules}}\label{classDMA_1_1Friends_1_1Models_1_1UserGroup_afe3638379efd008d908f38c86b434c76}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= [
        \textcolor{stringliteral}{'is\_active'} => \textcolor{stringliteral}{'boolean'}
\end{DoxyCode}


The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
models/User\-Group.\-php\end{DoxyCompactItemize}
