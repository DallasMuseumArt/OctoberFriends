\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\+S\+M\+S Class Reference}
\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S}}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\+S\+M\+S\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.060606cm]{d2/d14/classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a262b4247250915521d2d9962c9624fc7}{get\+Details} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}{config\+Channel} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}{setting\+Fields} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}{send} (\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1NotificationMessage}{Notification\+Message} \$message)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}{read} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}{webhook} (array \$request)
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ae6e3c43b02d2ccbb3fc4bd63ac5d7c9e}{get\+Key} ()
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aafb8c47b6e382d41069e13c3362b33fd}{clean\+Phone} (\$phone, \$use\+Timezone=true)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel}{Channel} for sending S\+M\+S notification using Twilio as gateway \begin{DoxyAuthor}{Author}
Carlos Arroyo 
\end{DoxyAuthor}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aafb8c47b6e382d41069e13c3362b33fd}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!clean\+Phone@{clean\+Phone}}
\index{clean\+Phone@{clean\+Phone}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{clean\+Phone}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::clean\+Phone (
\begin{DoxyParamCaption}
\item[{}]{\$phone, }
\item[{}]{\$use\+Timezone = {\ttfamily true}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aafb8c47b6e382d41069e13c3362b33fd}
Clean phone number for Twilio 
\begin{DoxyParams}[1]{Parameters}
string & {\em \$phone} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
string 
\end{DoxyReturn}

\begin{DoxyCode}
87     \{
88         \textcolor{comment}{// if Phone number is not in E164 try to parse it}
89         \textcolor{keywordflow}{if}(!preg\_match(\textcolor{stringliteral}{'/^\(\backslash\)+.\(\backslash\)d+$/'}, $phone))\{
90             \textcolor{keywordflow}{if}($useTimezone)\{
91                 $phoneUtil = PhoneNumberUtil::getInstance();
92                 \textcolor{keywordflow}{try} \{
93                     \textcolor{comment}{// Get country code using configure timezone}
94                     $tz = Carbon::now()->getTimezone();
95                     $country\_code = array\_get($tz->getLocation(), \textcolor{stringliteral}{'country\_code'}, \textcolor{stringliteral}{'US'});
96                     
97                     \textcolor{comment}{// Parse phone number}
98                     $numberProto = $phoneUtil->parse($phone, $country\_code);
99                    
100                     \textcolor{comment}{// Return phone}
101                     \textcolor{keywordflow}{return} $phoneUtil->format($numberProto, PhoneNumberFormat::E164);
102                 
103                 \} \textcolor{keywordflow}{catch} (\(\backslash\)libphonenumber\(\backslash\)NumberParseException $e) \{
104                     \textcolor{comment}{// Invalid phone let twilio complain :D}
105                     \textcolor{keywordflow}{return} \textcolor{stringliteral}{''};
106                 \} 
107             \} 
108             
109             \textcolor{comment}{// Just add missing plus sing}
110 
111             \textcolor{keywordflow}{return} \textcolor{charliteral}{'+'} . $phone;
112             
113         \}\textcolor{keywordflow}{else}\{
114             \textcolor{keywordflow}{return} $phone;
115         \}
116     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!config\+Channel@{config\+Channel}}
\index{config\+Channel@{config\+Channel}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{config\+Channel}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::config\+Channel (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}
Load channel configurations. \begin{DoxySeeAlso}{See also}
\+::config\+Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a63df08fbca39589ea32f729d9485cb37}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
49     \{
50         \textcolor{comment}{// TOOD : get this values for OctoberCMS settings}
51         $accountSid = Settings::get(\textcolor{stringliteral}{'twilio\_account\_id'});
52         $authToken  = Settings::get(\textcolor{stringliteral}{'twilio\_auth\_token'});       
53         $this->fromNumber = $this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aafb8c47b6e382d41069e13c3362b33fd}{cleanPhone}(Settings::get(\textcolor{stringliteral}{'twilio\_default\_from\_number'}), \textcolor{keyword}{false})
      ;
54 
55         $this->client = \textcolor{keyword}{new} \hyperlink{namespaceServices__Twilio}{Services\_Twilio}($accountSid, $authToken);
56     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a262b4247250915521d2d9962c9624fc7}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!get\+Details@{get\+Details}}
\index{get\+Details@{get\+Details}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{get\+Details}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::get\+Details (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a262b4247250915521d2d9962c9624fc7}
Return details of the channel. Manly used in the Backend interface.

\begin{DoxyReturn}{Returns}
array
\end{DoxyReturn}
eg. \mbox{[} \textquotesingle{}name\textquotesingle{} =$>$ \textquotesingle{}Kiosk\textquotesingle{}, \textquotesingle{}description\textquotesingle{} =$>$ \textquotesingle{}Store notification in the database. So they can be read in a Kiosk or a Web interface.\textquotesingle{} \mbox{]} \begin{DoxySeeAlso}{See also}
\+::get\+Details() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a78e25e374398ef085f37fb8d22203bdb}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
37     \{
38         \textcolor{keywordflow}{return} [
39                 \textcolor{stringliteral}{'name'}           => \textcolor{stringliteral}{'SMS'},
40                 \textcolor{stringliteral}{'description'}    => \textcolor{stringliteral}{'Send notifications by SMS using Twilio.'}
41         ];
42     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ae6e3c43b02d2ccbb3fc4bd63ac5d7c9e}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!get\+Key@{get\+Key}}
\index{get\+Key@{get\+Key}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{get\+Key}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::get\+Key (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ae6e3c43b02d2ccbb3fc4bd63ac5d7c9e}
Used to identify view per channel.

\begin{DoxyReturn}{Returns}
string 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a53b32a2d7c27477655a9d4b87164c203}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
28     \{
29         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'sms'};
30     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!read@{read}}
\index{read@{read}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::read (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}
Implemented specific logic for each channel for retriving incoming data through the channel.

\begin{DoxyReturn}{Returns}
array Array of \hyperlink{namespaceDMA}{D\+M\+A}
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::read\+Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Listenable_aebc4dc5c57897e075a719e911a590d6e}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Listenable}.


\begin{DoxyCode}
151     \{
152         \textcolor{keywordflow}{return} [];
153     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!send@{send}}
\index{send@{send}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{send}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::send (
\begin{DoxyParamCaption}
\item[{{\bf Notification\+Message}}]{\$message}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}
Send notifiation 
\begin{DoxyParams}{Parameters}
{\em \hyperlink{namespaceDMA}{D\+M\+A}} & \\
\hline
\end{DoxyParams}
 \begin{DoxySeeAlso}{See also}
\+::send() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a8138dfd93ce9617213637789e793f4c7}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
123     \{
124 
125         \textcolor{comment}{// TODO : add validation to control the size of the message.}
126         $toUser  = $message->getTo();
127         $data    = $message->getData();
128         $txt     = strip\_tags($message->getContent());
129 
130         $txt = $this->chunkLongText($txt);
131 
132         \textcolor{keywordflow}{foreach}($txt as $t) \{
133             \textcolor{comment}{// Clean phone user}
134             $toPhone = $this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aafb8c47b6e382d41069e13c3362b33fd}{cleanPhone}($toUser->phone);
135             \textcolor{keywordflow}{if} (!empty($toPhone)) \{
136                 $sms = $this->client->account->sms\_messages->create(
137                     $this->fromNumber, \textcolor{comment}{// From a Twilio number in your account}
138                     $toPhone, \textcolor{comment}{// Text any number}
139                     $t
140                 );
141             \}
142         \}
143        
144     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!setting\+Fields@{setting\+Fields}}
\index{setting\+Fields@{setting\+Fields}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{setting\+Fields}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::setting\+Fields (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}
Return settings fields for this channel. For futher information go to \href{http://octobercms.com/docs/plugin/settings#database-settings}{\tt http\+://octobercms.\+com/docs/plugin/settings\#database-\/settings}

\begin{DoxyReturn}{Returns}
array
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::setting\+Fields() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_aa473115fa58a6fa5f57a9069f23dd771}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
63     \{
64         \textcolor{keywordflow}{return} [
65             \textcolor{stringliteral}{'twilio\_account\_id'} => [
66                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio account ID'},
67                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
68             ],
69             \textcolor{stringliteral}{'twilio\_auth\_token'} => [
70                  \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio authentication token'},
71                  \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
72             ],
73             \textcolor{stringliteral}{'twilio\_default\_from\_number'} => [
74                  \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio default from number'},
75                  \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
76             ],
77         ];
78 
79     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!webhook@{webhook}}
\index{webhook@{webhook}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{webhook}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::webhook (
\begin{DoxyParamCaption}
\item[{array}]{\$request}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}
Implemented specific logic for each channel for retriving processing webhooks.

\begin{DoxyReturn}{Returns}
Symfony
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::webhook() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Webhook_a2836b9b100c55f657ee432bf3a7c9055}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Webhook}.


\begin{DoxyCode}
160     \{
161         $httpCode = 200;
162         \textcolor{keywordflow}{try}
163         \{
164             $msg = \textcolor{keyword}{new} IncomingMessage($this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ae6e3c43b02d2ccbb3fc4bd63ac5d7c9e}{getKey}());
165             $msg->from($request[\textcolor{stringliteral}{'From'}]);
166             $msg->setContent($request[\textcolor{stringliteral}{'Body'}]);
167 
168             \textcolor{comment}{// TODO : this should be reusable for other channels}
169             $key = $this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ae6e3c43b02d2ccbb3fc4bd63ac5d7c9e}{getKey}();
170             $event = strtolower(\textcolor{stringliteral}{"dma.channel.$key.incoming.data"});
171             Event::fire($event, [[$msg]]);
172             Log::debug(\textcolor{stringliteral}{'Processed Twilio incoming SMS'}, $msg->getData());
173         \}
174         \textcolor{keywordflow}{catch}(\(\backslash\)\hyperlink{namespaceException}{Exception} $e)
175         \{
176             Log::error(\textcolor{stringliteral}{'Processing Twilio webhook request'}, $request);
177             Log::error(sprintf(\textcolor{stringliteral}{'Processing Twilio webhook:  %s'}, $e));
178             $httpCode = 500;
179         \}
180 
181 
182         \textcolor{comment}{// Response message was read ok}
183         return \(\backslash\)Response::make(\textcolor{stringliteral}{'<Response></Response>'}, $httpCode);
184     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
classes/notifications/channels/Channel\+S\+M\+S.\+php\end{DoxyCompactItemize}
