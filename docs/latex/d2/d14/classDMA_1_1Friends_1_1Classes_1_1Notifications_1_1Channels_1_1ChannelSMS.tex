\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}{\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\+S\+M\+S Class Reference}
\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S}}
}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}Notifications\textbackslash{}Channels\textbackslash{}Channel\+S\+M\+S\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.060606cm]{d2/d14/classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_af645c26a2c6baf2e5106a464d7d74d7e}{get\+Key} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}{config\+Channel} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}{setting\+Fields} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}{send} (\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1NotificationMessage}{Notification\+Message} \$message)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}{read} ()
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}{webhook} (array \$request)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel}{Channel} for sending S\+M\+S notification using Twilio as gateway \begin{DoxyAuthor}{Author}
Carlos Arroyo 
\end{DoxyAuthor}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!config\+Channel@{config\+Channel}}
\index{config\+Channel@{config\+Channel}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{config\+Channel}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::config\+Channel (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a3b57af73b9e017991e9872232717b686}
Load channel configurations. \begin{DoxySeeAlso}{See also}
\+::config\+Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a63df08fbca39589ea32f729d9485cb37}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
34     \{
35         \textcolor{comment}{// TOOD : get this values for OctoberCMS settings}
36         $accountSid = Settings::get(\textcolor{stringliteral}{'twilio\_account\_id'});
37         $authToken  = Settings::get(\textcolor{stringliteral}{'twilio\_auth\_token'});
38         $this->fromNumber = Settings::get(\textcolor{stringliteral}{'twilio\_default\_from\_number'});
39 
40         $this->client = \textcolor{keyword}{new} \hyperlink{namespaceServices__Twilio}{Services\_Twilio}($accountSid, $authToken);
41     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_af645c26a2c6baf2e5106a464d7d74d7e}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!get\+Key@{get\+Key}}
\index{get\+Key@{get\+Key}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{get\+Key}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::get\+Key (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_af645c26a2c6baf2e5106a464d7d74d7e}
Used to identify view per channel.

\begin{DoxyReturn}{Returns}
string 
\end{DoxyReturn}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a2a1520c4a04a9533e0c755229376eb8a}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
25     \{
26         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'sms'};
27     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!read@{read}}
\index{read@{read}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::read (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_ad07cd397e4a5d268f56cf59c850f1583}
Implemented specific logic for each channel for retriving incoming data through the channel.

\begin{DoxyReturn}{Returns}
array Array of \hyperlink{namespaceDMA}{D\+M\+A}
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::read\+Channel() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Listenable_aebc4dc5c57897e075a719e911a590d6e}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Listenable}.


\begin{DoxyCode}
90     \{
91         \textcolor{keywordflow}{return} [];
92     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!send@{send}}
\index{send@{send}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{send}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::send (
\begin{DoxyParamCaption}
\item[{{\bf Notification\+Message}}]{\$message}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a74d477bcee51e0a8d4c27e482e775eb8}
Send notifiation 
\begin{DoxyParams}{Parameters}
{\em \hyperlink{namespaceDMA}{D\+M\+A}} & Friends \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::send() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_a8138dfd93ce9617213637789e793f4c7}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
71     \{
72 
73         \textcolor{comment}{// TODO : add validation to control the size of the message.}
74         $toUser  = $message->getTo();
75         $data    = $message->getData();
76         $txt     = $message->getContent();
77 
78         $sms = $this->client->account->sms\_messages->create(
79                 $this->fromNumber, \textcolor{comment}{// From a Twilio number in your account}
80                 $toUser->phone, \textcolor{comment}{// Text any number}
81                 $txt
82         );
83     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!setting\+Fields@{setting\+Fields}}
\index{setting\+Fields@{setting\+Fields}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{setting\+Fields}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::setting\+Fields (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_aee4d07da05caa5a14b8c126d6ccf2083}
Return settings fields for this channel. For futher information go to \href{http://octobercms.com/docs/plugin/settings#database-settings}{\tt http\+://octobercms.\+com/docs/plugin/settings\#database-\/settings}

\begin{DoxyReturn}{Returns}
array
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::setting\+Fields() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Channel_aa473115fa58a6fa5f57a9069f23dd771}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel}.


\begin{DoxyCode}
48     \{
49         \textcolor{keywordflow}{return} [
50             \textcolor{stringliteral}{'twilio\_account\_id'} => [
51                 \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio account ID'},
52                 \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
53             ],
54             \textcolor{stringliteral}{'twilio\_auth\_token'} => [
55                  \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio authentication token'},
56                  \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
57             ],
58             \textcolor{stringliteral}{'twilio\_default\_from\_number'} => [
59                  \textcolor{stringliteral}{'label'} => \textcolor{stringliteral}{'Twilio default from number'},
60                  \textcolor{stringliteral}{'span'}  => \textcolor{stringliteral}{'auto'}
61             ],
62         ];
63 
64     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}{\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}!webhook@{webhook}}
\index{webhook@{webhook}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+Notifications\+::\+Channels\+::\+Channel\+S\+M\+S}}
\subsubsection[{webhook}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Channel\+S\+M\+S\+::webhook (
\begin{DoxyParamCaption}
\item[{array}]{\$request}
\end{DoxyParamCaption}
)}}\label{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_a64e0d1bb196c93b02f3f208b50574c76}
Implemented specific logic for each channel for retriving processing webhooks.

\begin{DoxyReturn}{Returns}
Symfony
\end{DoxyReturn}
 \begin{DoxySeeAlso}{See also}
\+::webhook() 
\end{DoxySeeAlso}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1Webhook_a2836b9b100c55f657ee432bf3a7c9055}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Notifications\textbackslash{}\+Channels\textbackslash{}\+Webhook}.


\begin{DoxyCode}
99     \{
100         $httpCode = 200;
101         \textcolor{keywordflow}{try}
102         \{
103             $msg = \textcolor{keyword}{new} IncomingMessage($this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_af645c26a2c6baf2e5106a464d7d74d7e}{getKey}());
104             $msg->from($request[\textcolor{stringliteral}{'From'}]);
105             $msg->setContent($request[\textcolor{stringliteral}{'Body'}]);
106 
107             \textcolor{comment}{// TODO : this should be reusable for other channels}
108             $key = $this->\hyperlink{classDMA_1_1Friends_1_1Classes_1_1Notifications_1_1Channels_1_1ChannelSMS_af645c26a2c6baf2e5106a464d7d74d7e}{getKey}();
109             $event = \textcolor{stringliteral}{"dma.channel.$key.incoming.data"};
110             Event::fire($event, [$msg]);
111             Log::info(\textcolor{stringliteral}{'Processed Twilio incoming SMS'}, $msg->getData());
112         \}
113         \textcolor{keywordflow}{catch}(\(\backslash\)Exception $e)
114         \{
115             Log::error(\textcolor{stringliteral}{'Processing Twilio webhook request'}, $request);
116             Log::error(sprintf(\textcolor{stringliteral}{'Processing Twilio webhook:  %s'}, $e));
117             $httpCode = 500;
118         \}
119 
120 
121         \textcolor{comment}{// Response message was read ok}
122         return \(\backslash\)Response::make(\textcolor{stringliteral}{'<Response></Response>'}, $httpCode);
123     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
classes/notifications/channels/Channel\+S\+M\+S.\+php\end{DoxyCompactItemize}
