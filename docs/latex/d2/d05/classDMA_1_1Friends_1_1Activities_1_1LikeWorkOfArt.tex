\hypertarget{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Activities\textbackslash{}Like\+Work\+Of\+Art Class Reference}
\label{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Activities\textbackslash{}\+Like\+Work\+Of\+Art@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Activities\textbackslash{}\+Like\+Work\+Of\+Art}}
Inheritance diagram for D\+M\+A\textbackslash{}Friends\textbackslash{}Activities\textbackslash{}Like\+Work\+Of\+Art\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{d2/d05/classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ad8755c7d0fc4f34acfabc7716acfd52c}{details} ()
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_a88d1a454b4389e3116cc1f8a365747cd}{process} (User \$user, \$params=\mbox{[}$\,$\mbox{]})
\item 
static \hyperlink{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ac18459839d22721c79df721a6f9b7f8b}{is\+Assession\+Number} (\$code)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ad8755c7d0fc4f34acfabc7716acfd52c}{}\index{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}!details@{details}}
\index{details@{details}!D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}}
\subsubsection[{details}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Activities\textbackslash{}\+Like\+Work\+Of\+Art\+::details (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ad8755c7d0fc4f34acfabc7716acfd52c}


Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
21     \{
22         \textcolor{keywordflow}{return} [
23             \textcolor{stringliteral}{'name'}          => \textcolor{stringliteral}{'Like a work of art'},
24             \textcolor{stringliteral}{'description'}   => \textcolor{stringliteral}{'enter an assession id to like a work of art'},
25         ];
26     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ac18459839d22721c79df721a6f9b7f8b}{}\index{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}!is\+Assession\+Number@{is\+Assession\+Number}}
\index{is\+Assession\+Number@{is\+Assession\+Number}!D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}}
\subsubsection[{is\+Assession\+Number}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Activities\textbackslash{}\+Like\+Work\+Of\+Art\+::is\+Assession\+Number (
\begin{DoxyParamCaption}
\item[{}]{\$code}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_ac18459839d22721c79df721a6f9b7f8b}
Take a string of text and determine if it is an assession object


\begin{DoxyParams}{Parameters}
{\em string} & A string of text to check\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
mixed boolean, array boolean False if code is an assession number array if code is an assession number 
\end{DoxyReturn}

\begin{DoxyCode}
90     \{
91         \textcolor{comment}{// Brain API request template URL}
92         \textcolor{keywordflow}{if}($template = FriendsSettings::get(\textcolor{stringliteral}{'artwork\_api\_template'}, \textcolor{keyword}{false}))\{
93     
94             \textcolor{comment}{// Clean code from spaces in case user miss type it}
95             $code     = str\_replace(\textcolor{charliteral}{' '}, \textcolor{stringliteral}{''}, $code);
96             
97             \textcolor{comment}{// Get URL}
98             $url      = sprintf($template, urlencode($code));
99             
100             \textcolor{comment}{// Call Brain}
101             $response = Request::get($url)                   
102                                 ->send();
103             
104             \textcolor{keywordflow}{if}($obj = @$response->body->results[0])\{
105                 $data = [
106                     \textcolor{stringliteral}{'object\_id'}     => $obj->id,
107                     \textcolor{stringliteral}{'object\_number'} => $obj->number,
108                     \textcolor{stringliteral}{'object\_title'}  => $obj->title
109                 ];
110                 
111                 \textcolor{keywordflow}{return} $data;
112                
113             \}
114         \}\textcolor{keywordflow}{else}\{
115             Log::error(\textcolor{stringliteral}{'Friends setting "artwork\_api\_template" setting is empty. Please configure it in the
       backend of OctoberCMS.'});
116         \}
117         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
118         
119     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_a88d1a454b4389e3116cc1f8a365747cd}{}\index{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}!process@{process}}
\index{process@{process}!D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art@{D\+M\+A\+::\+Friends\+::\+Activities\+::\+Like\+Work\+Of\+Art}}
\subsubsection[{process}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Activities\textbackslash{}\+Like\+Work\+Of\+Art\+::process (
\begin{DoxyParamCaption}
\item[{User}]{\$user, }
\item[{}]{\$params = {\ttfamily \mbox{[}\mbox{]}}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{classDMA_1_1Friends_1_1Activities_1_1LikeWorkOfArt_a88d1a454b4389e3116cc1f8a365747cd}
\{inherit\+Doc\} 

Implements \hyperlink{interfaceDMA_1_1Friends_1_1Classes_1_1ActivityTypeBaseInterface}{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+Activity\+Type\+Base\+Interface}.


\begin{DoxyCode}
32     \{        
33         \textcolor{keywordflow}{if} (!isset($params[\textcolor{stringliteral}{'code'}]) || empty($params[\textcolor{stringliteral}{'code'}])) \textcolor{keywordflow}{return} \textcolor{keyword}{false};
34 
35         \textcolor{keywordflow}{if} ($activity = Activity::findActivityType(\textcolor{stringliteral}{'LikeWorkOfArt'})->first()) \{          
36             $code = $params[\textcolor{stringliteral}{'code'}];
37             
38             \textcolor{keywordflow}{if} ($data = self::isAssessionNumber($code))\{
39             
40                 \textcolor{comment}{// Skip activity process if user has already like this work of art}
41                 $likeCount = ActivityMetadata::hasMetadataValue($user, $activity, \textcolor{stringliteral}{'object\_id'}, $data[\textcolor{stringliteral}{'
      object\_id'}])->count();
42      
43                 \textcolor{keywordflow}{if} ($likeCount == 0) \{
44                     \textcolor{comment}{// User haven't like this artwork yet}
45                     \textcolor{keywordflow}{if} ($ret = parent::process($user, [\textcolor{stringliteral}{'activity'} => $activity])) \{
46                         
47                         \textcolor{comment}{// TODO: Find a better way to pass this data}
48                         $activity->objectData = $data;
49     
50                         \textcolor{comment}{// Save user metada activity}
51                         \hyperlink{classDMA_1_1Friends_1_1Models_1_1ActivityMetadata_ae65caa4e45de84ab2518f465d328fc24}{ActivityMetadata::addUserActivity}($user, $activity
      , $data, [\textcolor{stringliteral}{'object\_title'}]);
52     
53                         \hyperlink{classDMA_1_1Friends_1_1Classes_1_1FriendsLog_aa3c63d0a5b1ffcd9f58c03e443a2dc8f}{FriendsLog::artwork}([
54                             \textcolor{stringliteral}{'user'}          => $user,
55                             \textcolor{stringliteral}{'artwork\_id'}    => $params[\textcolor{stringliteral}{'code'}],
56                         ]);
57                     \}
58                 
59                     \textcolor{keywordflow}{return} $ret;
60                 \} \textcolor{keywordflow}{else} \{
61                     Session::put(\textcolor{stringliteral}{'activityError'}, Lang::get(\textcolor{stringliteral}{'
      dma.friends::lang.activities.alreadyLikeWorkArtError'}, [\textcolor{stringliteral}{'code'} => $params[\textcolor{stringliteral}{'code'}]]));
62                 \}
63                 
64             \} \textcolor{keywordflow}{else} \{
65                 \textcolor{comment}{// Verify if user try to enter an Object number}
66                 \textcolor{comment}{// Regex expression to match object number format}
67                 $re = \textcolor{stringliteral}{"/((([a-zA-Z0-9\_\(\backslash\)\(\backslash\)-]+\(\backslash\)\(\backslash\).)\{1,\})([a-zA-Z0-9\_\(\backslash\)\(\backslash\)-]+))/"};
68                 $isObjectNumber = (preg\_match\_all($re, str\_replace(\textcolor{charliteral}{' '}, \textcolor{stringliteral}{''},$code)) > 0); 
69                        
70                 \textcolor{keywordflow}{if} ( $isObjectNumber ) \{
71                     Session::put(\textcolor{stringliteral}{'activityError'}, Lang::get(\textcolor{stringliteral}{'
      dma.friends::lang.activities.likeWorkArtCodeError'}, [\textcolor{stringliteral}{'code'} => $params[\textcolor{stringliteral}{'code'}]]));
72                 \}
73             \}     
74        \}
75 
76         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
77 
78     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
activities/Like\+Work\+Of\+Art.\+php\end{DoxyCompactItemize}
