\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend}{}\section{D\+M\+A\textbackslash{}Friends\textbackslash{}Classes\textbackslash{}User\+Extend Class Reference}
\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend}\index{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend@{D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend}}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1UserExtend_aa399d503ccb972cb46171bd7cc2fbadf}{\+\_\+\+\_\+construct} (User \$user=null)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ae2d0cddf99425d8ffbe2ed2c74372024}{add\+Points} (\$points)
\item 
\hyperlink{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a72299c6e170b749617a262f18a8d7d67}{remove\+Points} (\$points, \$deduct=true)
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ac1de8e9326eaa1466503bf34fa0a3748}{}{\bfseries get\+Membership\+Status\+Options} ()\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ac1de8e9326eaa1466503bf34fa0a3748}

\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a0052edba29ca35647646bd33a05d9ccf}{}static {\bfseries upload\+Avatar} (\$user, \$image)\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a0052edba29ca35647646bd33a05d9ccf}

\item 
static \hyperlink{classDMA_1_1Friends_1_1Classes_1_1UserExtend_afdb44d04557d6679074fa0399f0ce843}{upload\+Avatar\+From\+String} (\$user, \$source)
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_aee1fe63ac574c2a6acabebcc00f2b4db}{}static {\bfseries parse\+Phone} (\$phone)\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_aee1fe63ac574c2a6acabebcc00f2b4db}

\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a02c168a2fdff54bad066263b4143c285}{}static {\bfseries parse\+Birthdate} (\$birthday)\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a02c168a2fdff54bad066263b4143c285}

\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ab5502f589b8c00f7a847a3ebece55281}{}{\bfseries \$user} = null\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ab5502f589b8c00f7a847a3ebece55281}

\end{DoxyCompactItemize}


\subsection{Constructor \& Destructor Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_aa399d503ccb972cb46171bd7cc2fbadf}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}!\+\_\+\+\_\+construct@{\+\_\+\+\_\+construct}}
\index{\+\_\+\+\_\+construct@{\+\_\+\+\_\+construct}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}}
\subsubsection[{\+\_\+\+\_\+construct}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend\+::\+\_\+\+\_\+construct (
\begin{DoxyParamCaption}
\item[{User}]{\$user = {\ttfamily null}}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_aa399d503ccb972cb46171bd7cc2fbadf}
Extended functionality against user objects This is a really ugly way to extend the functionality of the user object


\begin{DoxyParams}{Parameters}
{\em } & \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
42     \{
43         \textcolor{keywordflow}{if} (!$user)
44             $user = \textcolor{keyword}{new} \hyperlink{namespaceRainlab_1_1User_1_1Models_1_1User}{User};
45 
46         $this->user = $user;
47     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ae2d0cddf99425d8ffbe2ed2c74372024}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}!add\+Points@{add\+Points}}
\index{add\+Points@{add\+Points}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}}
\subsubsection[{add\+Points}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend\+::add\+Points (
\begin{DoxyParamCaption}
\item[{}]{\$points}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_ae2d0cddf99425d8ffbe2ed2c74372024}
Add points to a users account


\begin{DoxyParams}[1]{Parameters}
integer & {\em \$points} & The amount of points to add to a user \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
56     \{
57         \textcolor{keywordflow}{if} (!is\_numeric($points))
58             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{namespaceSystemException}{SystemException}(\textcolor{stringliteral}{'Points must be an integer'});
59 
60         $this->user->points += $points;
61         $this->user->points\_this\_week += $points;
62         $this->user->points\_today += $points;
63 
64         \textcolor{keywordflow}{if} ($this->user->forceSave()) \{
65 
66             \textcolor{comment}{// Process any activities awarded on points achievement}
67             \hyperlink{classDMA_1_1Friends_1_1Activities_1_1Points_a5822192344843b5a1948a8cbc737223d}{Points::process}($this->user);
68             
69             Event::fire(\textcolor{stringliteral}{'dma.friends.user.pointsEarned'}, [$this->user, $points]);
70 
71             $params = [
72                 \textcolor{stringliteral}{'user'}          => $this->user,
73                 \textcolor{stringliteral}{'points\_earned'} => $points,
74             ];
75             \hyperlink{classDMA_1_1Friends_1_1Classes_1_1FriendsLog_a083fa01b3e143ca77bdbb1562db724de}{FriendsLog::points}($params);
76         \}
77     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a72299c6e170b749617a262f18a8d7d67}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}!remove\+Points@{remove\+Points}}
\index{remove\+Points@{remove\+Points}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}}
\subsubsection[{remove\+Points}]{\setlength{\rightskip}{0pt plus 5cm}D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend\+::remove\+Points (
\begin{DoxyParamCaption}
\item[{}]{\$points, }
\item[{}]{\$deduct = {\ttfamily true}}
\end{DoxyParamCaption}
)}\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_a72299c6e170b749617a262f18a8d7d67}
Remove points from a user account


\begin{DoxyParams}[1]{Parameters}
integer & {\em \$points} & The amount of points to remove from a user account\\
\hline
boolean & {\em \$deduct} & If false points will not be deducted from leaderboard points\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
boolean returns true if points where removed 
\end{DoxyReturn}

\begin{DoxyCode}
92     \{
93         \textcolor{keywordflow}{if} (!is\_numeric($points))
94             \textcolor{keywordflow}{throw} \textcolor{keyword}{new} \hyperlink{namespaceSystemException}{SystemException}(\textcolor{stringliteral}{'Points must be an integer'});
95 
96         \textcolor{keywordflow}{if} ($this->user->points < $points) \{
97             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
98         \}
99 
100         $this->user->points -= $points;    
101 
102         \textcolor{keywordflow}{if} ($deduct) \{    
103             $this->user->points\_this\_week -= $points;
104             $this->user->points\_today -= $points;
105         \}
106         
107         \textcolor{keywordflow}{if} ($this->user->forceSave()) \{
108             Event::fire(\textcolor{stringliteral}{'dma.friends.user.pointsRemoved'}, [$this->user, $points]);
109         \}
110 
111         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
112     \}
\end{DoxyCode}
\hypertarget{classDMA_1_1Friends_1_1Classes_1_1UserExtend_afdb44d04557d6679074fa0399f0ce843}{}\index{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}!upload\+Avatar\+From\+String@{upload\+Avatar\+From\+String}}
\index{upload\+Avatar\+From\+String@{upload\+Avatar\+From\+String}!D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend@{D\+M\+A\+::\+Friends\+::\+Classes\+::\+User\+Extend}}
\subsubsection[{upload\+Avatar\+From\+String}]{\setlength{\rightskip}{0pt plus 5cm}static D\+M\+A\textbackslash{}\+Friends\textbackslash{}\+Classes\textbackslash{}\+User\+Extend\+::upload\+Avatar\+From\+String (
\begin{DoxyParamCaption}
\item[{}]{\$user, }
\item[{}]{\$source}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\label{classDMA_1_1Friends_1_1Classes_1_1UserExtend_afdb44d04557d6679074fa0399f0ce843}
Upload Avatar from Base64 encoded image


\begin{DoxyParams}[1]{Parameters}
\textbackslash{}\+Rain\+Lab\textbackslash{}\+User\textbackslash{}\+Models\textbackslash{}\+User & {\em \$user} & \\
\hline
string & {\em \$source} & string contend of an image on Base64 enconding \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
143     \{
144         $dst = \textcolor{stringliteral}{'/tmp/avatar\_'} . $user->getKey() . \textcolor{charliteral}{'\_'} . uniqid();
145         
146         FileHelper::put($dst, base64\_decode($source));
147         
148         $validImage = \textcolor{keyword}{true};
149         \textcolor{keywordflow}{try}\{
150             \textcolor{comment}{// Validated is a JPG or PNG}
151             $imageType = exif\_imagetype($dst);
152             $validImage = in\_array($imageType, [IMAGETYPE\_JPEG, IMAGETYPE\_PNG, IMAGETYPE\_GIF]);
153             \textcolor{comment}{// Validated is not bigger that xx by xx}
154             \textcolor{keywordflow}{if}($validImage)\{
155                 \textcolor{comment}{// Test if image is corrupted if OctoberCMS Resizer can open it}
156                 \textcolor{comment}{// is more likely the image is ok}
157                 Resizer::open($dst);
158                 
159                 \textcolor{comment}{// Test image dimensions}
160                 list($width, $height, $type, $attr) = getimagesize($dst);
161                 $validImage = ($width <= 400 && $height <= 400);
162 
163             \}
164             \textcolor{comment}{// Add right file extension to the upload file}
165             \textcolor{keywordflow}{if}($validImage)\{
166                 
167                 \textcolor{comment}{// Save image with correct image extension}
168                 $extension = [ IMAGETYPE\_JPEG => \textcolor{stringliteral}{'jpg'}, IMAGETYPE\_PNG => \textcolor{stringliteral}{'png'}, IMAGETYPE\_GIF => \textcolor{stringliteral}{'gif'}][
      $imageType];
169                 $newDst = $dst . \textcolor{charliteral}{'.'} . $extension;
170                 rename($dst, $newDst);
171                 $dst = $newDst;
172                 
173             \}
174         \} \textcolor{keywordflow}{catch}(\(\backslash\)\hyperlink{namespaceException}{Exception} $e)\{
175             $validImage = \textcolor{keyword}{false};
176         \}
177         
178         \textcolor{keywordflow}{if}(!$validImage)\{
179             \textcolor{keywordflow}{throw} new \(\backslash\)Exception(\textcolor{stringliteral}{'Must be a valid JPG, GIF or PNG. And not bigger that 400x400 pixels.'});
180         \}
181 
182         $file = \textcolor{keyword}{new} \hyperlink{namespaceFile}{File};
183         $file->data = $dst;
184         $file->is\_public = \textcolor{keyword}{true};
185         $file->save();
186     
187         \textcolor{keywordflow}{if} ($file) \{
188             $user->avatar()->add($file);
189         \}
190         
191     \}
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
classes/User\+Extend.\+php\end{DoxyCompactItemize}
